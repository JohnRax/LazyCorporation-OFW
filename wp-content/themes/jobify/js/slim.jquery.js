!function(a,b){"use strict";function d(a){return Array.prototype.slice.call(a)}function e(a){return"object"==typeof a[0]||0===a.length}function f(a,b,d){var e=Object.getOwnPropertyDescriptor(c.prototype,b);return!!e&&"undefined"!=typeof e.get}function g(a,b,d){var e=Object.getOwnPropertyDescriptor(c.prototype,b);return!!e&&"undefined"!=typeof e.set}function h(a,b){return"function"==typeof a[b]}if(a){var c=function(){function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function da(a,b){if(!(b>=1)){for(var c=a.width*b,d=a.height*b,e=a.width,f=a.height,g=a;e>c&&f>d;){var h=document.createElement("canvas");e=.5*g.width,f=.5*g.height,e<c&&(e=c),f<d&&(f=d),h.width=e,h.height=f;var i=h.getContext("2d");i.drawImage(g,0,0,e,f),g=ja(h)}a.width=c,a.height=d;var i=a.getContext("2d");i.drawImage(g,0,0,c,d)}}!function(){function a(a,c){c=c||{bubbles:!1,cancelable:!1,detail:b};var d=document.createEvent("CustomEvent");return d.initCustomEvent(a,c.bubbles,c.cancelable,c.detail),d}return"function"!=typeof window.CustomEvent&&(a.prototype=window.Event.prototype,void(window.CustomEvent=a))}();var a=function(b,c,d){var f,g,e=document.createElement("img");if(e.onerror=c,e.onload=function(){!g||d&&d.noRevoke||a.revokeObjectURL(g),c&&c(a.scale(e,d))},a.isInstanceOf("Blob",b)||a.isInstanceOf("File",b))f=g=a.createObjectURL(b),e._type=b.type;else{if("string"!=typeof b)return!1;f=b,d&&d.crossOrigin&&(e.crossOrigin=d.crossOrigin)}return f?(e.src=f,e):a.readFile(b,function(a){var b=a.target;b&&b.result?e.src=b.result:c&&c(a)})},c=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;a.isInstanceOf=function(a,b){return Object.prototype.toString.call(b)==="[object "+a+"]"},a.transformCoordinates=function(){},a.getTransformedOptions=function(a,b){var d,e,f,g,c=b.aspectRatio;if(!c)return b;d={};for(e in b)b.hasOwnProperty(e)&&(d[e]=b[e]);return d.crop=!0,f=a.naturalWidth||a.width,g=a.naturalHeight||a.height,f/g>c?(d.maxWidth=g*c,d.maxHeight=g):(d.maxWidth=f,d.maxHeight=f/c),d},a.renderImageToCanvas=function(a,b,c,d,e,f,g,h,i,j){return a.getContext("2d").drawImage(b,c,d,e,f,g,h,i,j),a},a.hasCanvasOption=function(a){return a.canvas||a.crop||!!a.aspectRatio},a.scale=function(c,d){function v(){var a=Math.max((m||i)/i,(n||j)/j);a>1&&(i*=a,j*=a)}function w(){var a=Math.min((k||i)/i,(l||j)/j);a<1&&(i*=a,j*=a)}d=d||{};var k,l,m,n,o,p,q,r,s,t,u,e=document.createElement("canvas"),f=c.getContext||a.hasCanvasOption(d)&&e.getContext,g=c.naturalWidth||c.width,h=c.naturalHeight||c.height,i=g,j=h;if(f&&(d=a.getTransformedOptions(c,d),q=d.left||0,r=d.top||0,d.sourceWidth?(o=d.sourceWidth,d.right!==b&&d.left===b&&(q=g-o-d.right)):o=g-q-(d.right||0),d.sourceHeight?(p=d.sourceHeight,d.bottom!==b&&d.top===b&&(r=h-p-d.bottom)):p=h-r-(d.bottom||0),i=o,j=p),k=d.maxWidth,l=d.maxHeight,m=d.minWidth,n=d.minHeight,f&&k&&l&&d.crop?(i=k,j=l,u=o/p-k/l,u<0?(p=l*o/k,d.top===b&&d.bottom===b&&(r=(h-p)/2)):u>0&&(o=k*p/l,d.left===b&&d.right===b&&(q=(g-o)/2))):((d.contain||d.cover)&&(m=k=k||m,n=l=l||n),d.cover?(w(),v()):(v(),w())),f){if(s=d.pixelRatio,s>1&&(e.style.width=i+"px",e.style.height=j+"px",i*=s,j*=s,e.getContext("2d").scale(s,s)),t=d.downsamplingRatio,t>0&&t<1&&i<o&&j<p)for(;o*t>i;)e.width=o*t,e.height=p*t,a.renderImageToCanvas(e,c,q,r,o,p,0,0,e.width,e.height),o=e.width,p=e.height,c=document.createElement("canvas"),c.width=o,c.height=p,a.renderImageToCanvas(c,e,0,0,o,p,0,0,o,p);return e.width=i,e.height=j,a.transformCoordinates(e,d),a.renderImageToCanvas(e,c,q,r,o,p,0,0,i,j)}return c.width=i,c.height=j,c},a.createObjectURL=function(a){return!!c&&c.createObjectURL(a)},a.revokeObjectURL=function(a){return!!c&&c.revokeObjectURL(a)},a.readFile=function(a,b,c){if(window.FileReader){var d=new FileReader;if(d.onload=d.onerror=b,c=c||"readAsDataURL",d[c])return d[c](a),d}return!1};var d=a.hasCanvasOption,e=a.transformCoordinates,f=a.getTransformedOptions;a.hasCanvasOption=function(b){return!!b.orientation||d.call(a,b)},a.transformCoordinates=function(b,c){e.call(a,b,c);var d=b.getContext("2d"),f=b.width,g=b.height,h=b.style.width,i=b.style.height,j=c.orientation;if(j&&!(j>8))switch(j>4&&(b.width=g,b.height=f,b.style.width=i,b.style.height=h),j){case 2:d.translate(f,0),d.scale(-1,1);break;case 3:d.translate(f,g),d.rotate(Math.PI);break;case 4:d.translate(0,g),d.scale(1,-1);break;case 5:d.rotate(.5*Math.PI),d.scale(1,-1);break;case 6:d.rotate(.5*Math.PI),d.translate(0,-g);break;case 7:d.rotate(.5*Math.PI),d.translate(f,-g),d.scale(-1,1);break;case 8:d.rotate(-.5*Math.PI),d.translate(-f,0)}},a.getTransformedOptions=function(b,c){var g,h,d=f.call(a,b,c),e=d.orientation;if(!e||e>8||1===e)return d;g={};for(h in d)d.hasOwnProperty(h)&&(g[h]=d[h]);switch(d.orientation){case 2:g.left=d.right,g.right=d.left;break;case 3:g.left=d.right,g.top=d.bottom,g.right=d.left,g.bottom=d.top;break;case 4:g.top=d.bottom,g.bottom=d.top;break;case 5:g.left=d.top,g.top=d.left,g.right=d.bottom,g.bottom=d.right;break;case 6:g.left=d.top,g.top=d.right,g.right=d.bottom,g.bottom=d.left;break;case 7:g.left=d.bottom,g.top=d.right,g.right=d.top,g.bottom=d.left;break;case 8:g.left=d.bottom,g.top=d.left,g.right=d.top,g.bottom=d.right}return d.orientation>4&&(g.maxWidth=d.maxHeight,g.maxHeight=d.maxWidth,g.minWidth=d.minHeight,g.minHeight=d.minWidth,g.sourceWidth=d.sourceHeight,g.sourceHeight=d.sourceWidth),g};var g=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);a.blobSlice=g&&function(){var a=this.slice||this.webkitSlice||this.mozSlice;return a.apply(this,arguments)},a.metaDataParsers={jpeg:{65505:[]}},a.parseMetaData=function(b,c,d){d=d||{};var e=this,f=d.maxMetaDataSize||262144,g={},h=!(window.DataView&&b&&b.size>=12&&"image/jpeg"===b.type&&a.blobSlice);!h&&a.readFile(a.blobSlice.call(b,0,f),function(b){if(b.target.error)return void c(g);var l,m,n,o,f=b.target.result,h=new DataView(f),i=2,j=h.byteLength-4,k=i;if(65496===h.getUint16(0)){for(;i<j&&(l=h.getUint16(i),l>=65504&&l<=65519||65534===l)&&(m=h.getUint16(i+2)+2,!(i+m>h.byteLength));){if(n=a.metaDataParsers.jpeg[l])for(o=0;o<n.length;o+=1)n[o].call(e,h,i,m,g,d);i+=m,k=i}!d.disableImageHead&&k>6&&(f.slice?g.imageHead=f.slice(0,k):g.imageHead=new Uint8Array(f).subarray(0,k))}c(g)},"readAsArrayBuffer")||c(g)},a.ExifMap=function(){return this},a.ExifMap.prototype.map={Orientation:274},a.ExifMap.prototype.get=function(a){return this[a]||this[this.map[a]]},a.getExifThumbnail=function(a,b,c){var d,e,f;if(c&&!(b+c>a.byteLength)){for(d=[],e=0;e<c;e+=1)f=a.getUint8(b+e),d.push((f<16?"0":"")+f.toString(16));return"data:image/jpeg,%"+d.join("%")}},a.exifTagTypes={1:{getValue:function(a,b){return a.getUint8(b)},size:1},2:{getValue:function(a,b){return String.fromCharCode(a.getUint8(b))},size:1,ascii:!0},3:{getValue:function(a,b,c){return a.getUint16(b,c)},size:2},4:{getValue:function(a,b,c){return a.getUint32(b,c)},size:4},5:{getValue:function(a,b,c){return a.getUint32(b,c)/a.getUint32(b+4,c)},size:8},9:{getValue:function(a,b,c){return a.getInt32(b,c)},size:4},10:{getValue:function(a,b,c){return a.getInt32(b,c)/a.getInt32(b+4,c)},size:8}},a.exifTagTypes[7]=a.exifTagTypes[1],a.getExifValue=function(b,c,d,e,f,g){var i,j,k,l,m,n,h=a.exifTagTypes[e];if(h&&(i=h.size*f,j=i>4?c+b.getUint32(d+8,g):d+8,!(j+i>b.byteLength))){if(1===f)return h.getValue(b,j,g);for(k=[],l=0;l<f;l+=1)k[l]=h.getValue(b,j+l*h.size,g);if(h.ascii){for(m="",l=0;l<k.length&&(n=k[l],"\0"!==n);l+=1)m+=n;return m}return k}},a.parseExifTag=function(b,c,d,e,f){var g=b.getUint16(d,e);f.exif[g]=a.getExifValue(b,c,d,b.getUint16(d+2,e),b.getUint32(d+4,e),e)},a.parseExifTags=function(a,b,c,d,e){var f,g,h;if(!(c+6>a.byteLength||(f=a.getUint16(c,d),g=c+2+12*f,g+4>a.byteLength))){for(h=0;h<f;h+=1)this.parseExifTag(a,b,c+2+12*h,d,e);return a.getUint32(g,d)}},a.parseExifData=function(b,c,d,e,f){if(!f.disableExif){var h,i,j,g=c+10;if(1165519206===b.getUint32(c+4)&&!(g+8>b.byteLength)&&0===b.getUint16(c+8)){switch(b.getUint16(g)){case 18761:h=!0;break;case 19789:h=!1;break;default:return}42===b.getUint16(g+2,h)&&(i=b.getUint32(g+4,h),e.exif=new a.ExifMap,i=a.parseExifTags(b,g,g+i,h,e),i&&!f.disableExifThumbnail&&(j={exif:{}},i=a.parseExifTags(b,g,g+i,h,j),j.exif[513]&&(e.exif.Thumbnail=a.getExifThumbnail(b,g+j.exif[513],j.exif[514]))),e.exif[34665]&&!f.disableExifSub&&a.parseExifTags(b,g,g+e.exif[34665],h,e),e.exif[34853]&&!f.disableExifGps&&a.parseExifTags(b,g,g+e.exif[34853],h,e))}}},a.metaDataParsers.jpeg[65505].push(a.parseExifData);var h=function(){var a=[],c=[],d=[],e="transform",f=window.getComputedStyle(document.documentElement,""),g=(Array.prototype.slice.call(f).join("").match(/-(moz|webkit|ms)-/)||""===f.OLink&&["","o"])[1];"webkit"===g&&(e="webkitTransform");var h=function(a,c,d){var e=a;if(e.length!==b){for(var f={chainers:[],then:function(a){return this.snabbt(a)},snabbt:function(a){var b=this.chainers.length;return this.chainers.forEach(function(c,d){c.snabbt(i(a,d,b))}),f},setValue:function(a){return this.chainers.forEach(function(b){b.setValue(a)}),f},finish:function(){return this.chainers.forEach(function(a){a.finish()}),f},rollback:function(){return this.chainers.forEach(function(a){a.rollback()}),f}},g=0,h=e.length;g<h;++g)"string"==typeof c?f.chainers.push(j(e[g],c,i(d,g,h))):f.chainers.push(j(e[g],i(c,g,h),d));return f}return"string"==typeof c?j(e,c,i(d,0,1)):j(e,i(c,0,1),d)},i=function(a,b,c){if(!a)return a;var d=Y(a);X(a.delay)&&(d.delay=a.delay(b,c)),X(a.callback)&&(d.complete=function(){a.callback.call(this,b,c)});var e=X(a.allDone),f=X(a.complete);(f||e)&&(d.complete=function(){f&&a.complete.call(this,b,c),e&&b==c-1&&a.allDone()}),X(a.valueFeeder)&&(d.valueFeeder=function(d,e){return a.valueFeeder(d,e,b,c)}),X(a.easing)&&(d.easing=function(d){return a.easing(d,b,c)});var g=["position","rotation","skew","rotationPost","scale","width","height","opacity","fromPosition","fromRotation","fromSkew","fromRotationPost","fromScale","fromWidth","fromHeight","fromOpacity","transformOrigin","duration","delay"];return g.forEach(function(e){X(a[e])&&(d[e]=a[e](b,c))}),d},j=function(a,b,d){function r(b){if(m.tick(b),m.updateElement(a),!m.isStopped())return m.completed()?void(e.loop>1&&!m.isStopped()?(e.loop-=1,m.restart(),w(r)):(e.complete&&e.complete.call(a),o.length&&(e=o.pop(),g=t(e,h,!0),h=t(e,Y(h)),e=u(g,h,e),m=y(e),c.push([a,m]),m.tick(b),w(r)))):w(r)}if("attention"===b)return k(a,d);if("stop"===b)return l(a);if("detach"===b)return n(a);var e=b;q();var f=s(a),g=f;g=t(e,g,!0);var h=Y(f);h=t(e,h);var j=u(g,h,e),m=y(j);c.push([a,m]),m.updateElement(a,!0);var o=[],p={snabbt:function(a){return o.unshift(i(a,0,1)),p},then:function(a){return this.snabbt(a)}};return w(r),e.manual?m:p},k=function(a,b){function f(c){e.tick(c),e.updateElement(a),e.completed()?(b.callback&&b.callback(a),b.loop&&b.loop>1&&(b.loop--,e.restart(),w(f))):w(f)}var d=t(b,R({}));b.movement=d;var e=z(b);c.push([a,e]),w(f)},l=function(a){for(var b=0,d=c.length;b<d;++b){var e=c[b],f=e[0],g=e[1];f===a&&g.stop()}},m=function(a,b){for(var c=0,d=a.length;c<d;++c)if(a[c][0]===b)return c;return-1},n=function(a){var f,g,b=[],e=c.concat(d),h=e.length;for(g=0;g<h;++g)f=e[g][0],(a.contains(f)||a===f)&&b.push(f);for(h=b.length,g=0;g<h;++g)o(b[g])},o=function(a){l(a);var b=m(c,a);b>=0&&c.splice(b,1),b=m(d,a),b>=0&&d.splice(b,1)},p=function(a,b){for(var c=0,d=a.length;c<d;++c){var e=a[c],f=e[0],g=e[1];if(f===b){var h=g.getCurrentState();return g.stop(),h}}},q=function(){d=d.filter(function(a){return r(a[0]).body})},r=function(a){for(var b=a;b.parentNode;)b=b.parentNode;return b},s=function(a){var b=p(c,a);return b?b:p(d,a)},t=function(a,b,c){b||(b=R({position:[0,0,0],rotation:[0,0,0],rotationPost:[0,0,0],scale:[1,1],skew:[0,0]}));var d="position",e="rotation",f="skew",g="rotationPost",h="scale",i="scalePost",j="width",k="height",l="opacity";return c&&(d="fromPosition",e="fromRotation",f="fromSkew",g="fromRotationPost",h="fromScale",i="fromScalePost",j="fromWidth",k="fromHeight",l="fromOpacity"),b.position=U(a[d],b.position),b.rotation=U(a[e],b.rotation),b.rotationPost=U(a[g],b.rotationPost),b.skew=U(a[f],b.skew),b.scale=U(a[h],b.scale),b.scalePost=U(a[i],b.scalePost),b.opacity=a[l],b.width=a[j],b.height=a[k],b},u=function(a,b,c){return c.startState=a,c.endState=b,c},v=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return setTimeout(a,1e3/60)},w=function(b){0===a.length&&v(x),a.push(b)},x=function(b){for(var e=a.length,f=0;f<e;++f)a[f](b);a.splice(0,e);var g=c.filter(function(a){return a[1].completed()});d=d.filter(function(a){for(var b=0,c=g.length;b<c;++b)if(a[0]===g[b][0])return!1;return!0}),d=d.concat(g),c=c.filter(function(a){return!a[1].completed()}),0!==a.length&&v(x)},y=function(a){var c=a.startState,d=a.endState,e=U(a.duration,500),f=U(a.delay,0),g=a.perspective,h=G(U(a.easing,"linear"),a),i=0===e?d.clone():c.clone();a.transformOrigin;i.transformOrigin=a.transformOrigin;var r,s,k=0,l=0,m=!1,n=!1,o=a.manual,p=0,q=f/e;return s=a.valueFeeder?T(a.valueFeeder,c,d,i):S(c,d,i),{stop:function(){m=!0},isStopped:function(){return m},finish:function(a){o=!1;var b=e*p;k=l-b,r=a,h.resetFrom=p},rollback:function(a){o=!1,s.setReverse();var b=e*(1-p);k=l-b,r=a,h.resetFrom=p},restart:function(){k=b,h.resetFrom(0)},tick:function(a){if(!m){if(o)return l=a,void this.updateCurrentTransform();if(k||(k=a),a-k>f){n=!0,l=a-f;var b=Math.min(Math.max(0,l-k),e);h.tick(b/e),this.updateCurrentTransform(),this.completed()&&r&&r()}}},getCurrentState:function(){return i},setValue:function(a){n=!0,p=Math.min(Math.max(a,1e-4),1+q)},updateCurrentTransform:function(){var a=h.getValue();if(o){var b=Math.max(1e-5,p-q);h.tick(b),a=h.getValue()}s.tween(a)},completed:function(){return!!m||0!==k&&h.completed()},updateElement:function(a,b){if(n||b){var c=s.asMatrix(),d=s.getProperties();V(a,c,g),W(a,d)}}}},z=function(a){var c=a.movement;a.initialVelocity=.1,a.equilibriumPosition=0;var d=E(a),e=!1,f=c.position,g=c.rotation,h=c.rotationPost,i=c.scale,j=c.skew,k=R({position:f?[0,0,0]:b,rotation:g?[0,0,0]:b,rotationPost:h?[0,0,0]:b,scale:i?[0,0]:b,skew:j?[0,0]:b});return{stop:function(){e=!0},isStopped:function(a){return e},tick:function(a){e||d.equilibrium||(d.tick(),this.updateMovement())},updateMovement:function(){var a=d.getValue();f&&(k.position[0]=c.position[0]*a,k.position[1]=c.position[1]*a,k.position[2]=c.position[2]*a),g&&(k.rotation[0]=c.rotation[0]*a,k.rotation[1]=c.rotation[1]*a,k.rotation[2]=c.rotation[2]*a),h&&(k.rotationPost[0]=c.rotationPost[0]*a,k.rotationPost[1]=c.rotationPost[1]*a,k.rotationPost[2]=c.rotationPost[2]*a),i&&(k.scale[0]=1+c.scale[0]*a,k.scale[1]=1+c.scale[1]*a),j&&(k.skew[0]=c.skew[0]*a,k.skew[1]=c.skew[1]*a)},updateElement:function(a){V(a,k.asMatrix()),W(a,k.getProperties())},getCurrentState:function(){return k},completed:function(){return d.equilibrium||e},restart:function(){d=E(a)}}},A=function(a){return a},B=function(a){return(Math.cos(a*Math.PI+Math.PI)+1)/2},C=function(a){return a*a},D=function(a){return-Math.pow(a-1,2)+1},E=function(a){var b=U(a.startPosition,0),c=U(a.equilibriumPosition,1),d=U(a.initialVelocity,0),e=U(a.springConstant,.8),f=U(a.springDeceleration,.9),g=U(a.springMass,10),h=!1;return{tick:function(a){if(0!==a&&!h){var i=-(b-c)*e,j=i/g;d+=j,b+=d,d*=f,Math.abs(b-c)<.001&&Math.abs(d)<.001&&(h=!0)}},resetFrom:function(a){b=a,d=0},getValue:function(){return h?c:b},completed:function(){return h}}},F={linear:A,ease:B,easeIn:C,easeOut:D},G=function(a,b){if("spring"==a)return E(b);var c=a;X(a)||(c=F[a]);var f,d=c,e=0;return{tick:function(a){e=d(a),f=a},resetFrom:function(a){f=0},getValue:function(){return e},completed:function(){return f>=1&&f}}},H=function(a,b,c,d){a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=b,a[13]=c,a[14]=d,a[15]=1},I=function(a,b){a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=Math.cos(b),a[6]=-Math.sin(b),a[7]=0,a[8]=0,a[9]=Math.sin(b),a[10]=Math.cos(b),a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1},J=function(a,b){a[0]=Math.cos(b),a[1]=0,a[2]=Math.sin(b),a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=-Math.sin(b),a[9]=0,a[10]=Math.cos(b),a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1},K=function(a,b){a[0]=Math.cos(b),a[1]=-Math.sin(b),a[2]=0,a[3]=0,a[4]=Math.sin(b),a[5]=Math.cos(b),a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1},L=function(a,b,c){a[0]=1,a[1]=Math.tan(b),a[2]=0,a[3]=0,a[4]=Math.tan(c),a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1},M=function(a,b,c){a[0]=b,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=c,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1},N=function(a){a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1},O=function(a,b){b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]},P=function(){var a=new Float32Array(16),b=new Float32Array(16),c=new Float32Array(16);return N(a),{data:a,asCSS:function(){for(var b="matrix3d(",c=0;c<15;++c)b+=Math.abs(a[c])<1e-4?"0,":a[c].toFixed(10)+",";return b+=Math.abs(a[15])<1e-4?"0)":a[15].toFixed(10)+")"},clear:function(){N(a)},translate:function(d,e,f){return O(a,b),H(c,d,e,f),Q(b,c,a),this},rotateX:function(d){return O(a,b),I(c,d),Q(b,c,a),this},rotateY:function(d){return O(a,b),J(c,d),Q(b,c,a),this},rotateZ:function(d){return O(a,b),K(c,d),Q(b,c,a),this},scale:function(d,e){return O(a,b),M(c,d,e),Q(b,c,a),this},skew:function(d,e){return O(a,b),L(c,d,e),Q(b,c,a),this}}},Q=function(a,b,c){return c[0]=a[0]*b[0]+a[1]*b[4]+a[2]*b[8]+a[3]*b[12],c[1]=a[0]*b[1]+a[1]*b[5]+a[2]*b[9]+a[3]*b[13],c[2]=a[0]*b[2]+a[1]*b[6]+a[2]*b[10]+a[3]*b[14],c[3]=a[0]*b[3]+a[1]*b[7]+a[2]*b[11]+a[3]*b[15],c[4]=a[4]*b[0]+a[5]*b[4]+a[6]*b[8]+a[7]*b[12],c[5]=a[4]*b[1]+a[5]*b[5]+a[6]*b[9]+a[7]*b[13],c[6]=a[4]*b[2]+a[5]*b[6]+a[6]*b[10]+a[7]*b[14],c[7]=a[4]*b[3]+a[5]*b[7]+a[6]*b[11]+a[7]*b[15],c[8]=a[8]*b[0]+a[9]*b[4]+a[10]*b[8]+a[11]*b[12],c[9]=a[8]*b[1]+a[9]*b[5]+a[10]*b[9]+a[11]*b[13],c[10]=a[8]*b[2]+a[9]*b[6]+a[10]*b[10]+a[11]*b[14],c[11]=a[8]*b[3]+a[9]*b[7]+a[10]*b[11]+a[11]*b[15],c[12]=a[12]*b[0]+a[13]*b[4]+a[14]*b[8]+a[15]*b[12],c[13]=a[12]*b[1]+a[13]*b[5]+a[14]*b[9]+a[15]*b[13],c[14]=a[12]*b[2]+a[13]*b[6]+a[14]*b[10]+a[15]*b[14],c[15]=a[12]*b[3]+a[13]*b[7]+a[14]*b[11]+a[15]*b[15],c},R=function(a){var c=P(),d={opacity:b,width:b,height:b};return{position:a.position,rotation:a.rotation,rotationPost:a.rotationPost,skew:a.skew,scale:a.scale,scalePost:a.scalePost,opacity:a.opacity,width:a.width,height:a.height,clone:function(){return R({position:this.position?this.position.slice(0):b,rotation:this.rotation?this.rotation.slice(0):b,rotationPost:this.rotationPost?this.rotationPost.slice(0):b,skew:this.skew?this.skew.slice(0):b,scale:this.scale?this.scale.slice(0):b,scalePost:this.scalePost?this.scalePost.slice(0):b,height:this.height,width:this.width,opacity:this.opacity})},asMatrix:function(){var a=c;return a.clear(),this.transformOrigin&&a.translate(-this.transformOrigin[0],-this.transformOrigin[1],-this.transformOrigin[2]),this.scale&&a.scale(this.scale[0],this.scale[1]),this.skew&&a.skew(this.skew[0],this.skew[1]),this.rotation&&(a.rotateX(this.rotation[0]),a.rotateY(this.rotation[1]),a.rotateZ(this.rotation[2])),this.position&&a.translate(this.position[0],this.position[1],this.position[2]),this.rotationPost&&(a.rotateX(this.rotationPost[0]),a.rotateY(this.rotationPost[1]),a.rotateZ(this.rotationPost[2])),this.scalePost&&a.scale(this.scalePost[0],this.scalePost[1]),this.transformOrigin&&a.translate(this.transformOrigin[0],this.transformOrigin[1],this.transformOrigin[2]),a},getProperties:function(){return d.opacity=this.opacity,d.width=this.width+"px",d.height=this.height+"px",d}}},S=function(a,c,d){var e=a,f=c,g=d,h=f.position!==b,i=f.rotation!==b,j=f.rotationPost!==b,k=f.scale!==b,l=f.skew!==b,m=f.width!==b,n=f.height!==b,o=f.opacity!==b;return{tween:function(a){if(h){var b=f.position[0]-e.position[0],c=f.position[1]-e.position[1],d=f.position[2]-e.position[2];g.position[0]=e.position[0]+a*b,g.position[1]=e.position[1]+a*c,g.position[2]=e.position[2]+a*d}if(i){var p=f.rotation[0]-e.rotation[0],q=f.rotation[1]-e.rotation[1],r=f.rotation[2]-e.rotation[2];g.rotation[0]=e.rotation[0]+a*p,g.rotation[1]=e.rotation[1]+a*q,g.rotation[2]=e.rotation[2]+a*r}if(j){var s=f.rotationPost[0]-e.rotationPost[0],t=f.rotationPost[1]-e.rotationPost[1],u=f.rotationPost[2]-e.rotationPost[2];g.rotationPost[0]=e.rotationPost[0]+a*s,g.rotationPost[1]=e.rotationPost[1]+a*t,g.rotationPost[2]=e.rotationPost[2]+a*u}if(l){var v=f.scale[0]-e.scale[0],w=f.scale[1]-e.scale[1];g.scale[0]=e.scale[0]+a*v,g.scale[1]=e.scale[1]+a*w}if(k){var x=f.skew[0]-e.skew[0],y=f.skew[1]-e.skew[1];g.skew[0]=e.skew[0]+a*x,g.skew[1]=e.skew[1]+a*y}if(m){var z=f.width-e.width;g.width=e.width+a*z}if(n){var A=f.height-e.height;g.height=e.height+a*A}if(o){var B=f.opacity-e.opacity;g.opacity=e.opacity+a*B}},asMatrix:function(){return g.asMatrix()},getProperties:function(){return g.getProperties()},setReverse:function(){var a=e;e=f,f=a}}},T=function(a,c,d,e){var f=a(0,P()),g=c,h=d,i=e,j=!1;return{tween:function(c){j&&(c=1-c),f.clear(),f=a(c,f);var d=h.width-g.width,e=h.height-g.height,k=h.opacity-g.opacity;h.width!==b&&(i.width=g.width+c*d),h.height!==b&&(i.height=g.height+c*e),h.opacity!==b&&(i.opacity=g.opacity+c*k)},asMatrix:function(){return f},getProperties:function(){return i.getProperties()},setReverse:function(){j=!0}}},U=function(a,b){return"undefined"==typeof a?b:a},V=function(a,b,c){var d="";c&&(d="perspective("+c+"px) ");var f=b.asCSS();a.style[e]=d+f},W=function(a,b){for(var c in b)a.style[c]=b[c]},X=function(a){return"function"==typeof a},Y=function(a){if(!a)return a;var b={};for(var c in a)b[c]=a[c];return b};return h.createMatrix=P,h.setElementTransform=V,h}(),i=function(){function c(a,b,c,d,e){if("string"==typeof a)a=document.getElementById(a);else if(!a instanceof HTMLCanvasElement)return;var g,f=a.getContext("2d");try{try{g=f.getImageData(b,c,d,e)}catch(a){throw new Error("unable to access local image data: "+a)}}catch(a){throw new Error("unable to access image data: "+a)}return g}function d(a,b,d,f,g,h){if(!(isNaN(h)||h<1)){h|=0;var i=c(a,b,d,f,g);i=e(i,b,d,f,g,h),a.getContext("2d").putImageData(i,b,d)}}function e(c,d,e,g,h,i){var k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,j=c.data,I=i+i+1,K=g-1,L=h-1,M=i+1,N=M*(M+1)/2,O=new f,P=O;for(m=1;m<I;m++)if(P=P.next=new f,m==M)var Q=P;P.next=O;var R=null,S=null;q=p=0;var T=a[i],U=b[i];for(l=0;l<h;l++){for(z=A=B=C=r=s=t=u=0,v=M*(D=j[p]),w=M*(E=j[p+1]),x=M*(F=j[p+2]),y=M*(G=j[p+3]),r+=N*D,s+=N*E,t+=N*F,u+=N*G,P=O,m=0;m<M;m++)P.r=D,P.g=E,P.b=F,P.a=G,P=P.next;for(m=1;m<M;m++)n=p+((K<m?K:m)<<2),r+=(P.r=D=j[n])*(H=M-m),s+=(P.g=E=j[n+1])*H,t+=(P.b=F=j[n+2])*H,u+=(P.a=G=j[n+3])*H,z+=D,A+=E,B+=F,C+=G,P=P.next;for(R=O,S=Q,k=0;k<g;k++)j[p+3]=G=u*T>>U,0!=G?(G=255/G,j[p]=(r*T>>U)*G,j[p+1]=(s*T>>U)*G,j[p+2]=(t*T>>U)*G):j[p]=j[p+1]=j[p+2]=0,r-=v,s-=w,t-=x,u-=y,v-=R.r,w-=R.g,x-=R.b,y-=R.a,n=q+((n=k+i+1)<K?n:K)<<2,z+=R.r=j[n],A+=R.g=j[n+1],B+=R.b=j[n+2],C+=R.a=j[n+3],r+=z,s+=A,t+=B,u+=C,R=R.next,v+=D=S.r,w+=E=S.g,x+=F=S.b,y+=G=S.a,z-=D,A-=E,B-=F,C-=G,S=S.next,p+=4;q+=g}for(k=0;k<g;k++){for(A=B=C=z=s=t=u=r=0,p=k<<2,v=M*(D=j[p]),w=M*(E=j[p+1]),x=M*(F=j[p+2]),y=M*(G=j[p+3]),r+=N*D,s+=N*E,t+=N*F,u+=N*G,P=O,m=0;m<M;m++)P.r=D,P.g=E,P.b=F,P.a=G,P=P.next;for(o=g,m=1;m<=i;m++)p=o+k<<2,r+=(P.r=D=j[p])*(H=M-m),s+=(P.g=E=j[p+1])*H,t+=(P.b=F=j[p+2])*H,u+=(P.a=G=j[p+3])*H,z+=D,A+=E,B+=F,C+=G,P=P.next,m<L&&(o+=g);for(p=k,R=O,S=Q,l=0;l<h;l++)n=p<<2,j[n+3]=G=u*T>>U,G>0?(G=255/G,j[n]=(r*T>>U)*G,j[n+1]=(s*T>>U)*G,j[n+2]=(t*T>>U)*G):j[n]=j[n+1]=j[n+2]=0,r-=v,s-=w,t-=x,u-=y,v-=R.r,w-=R.g,x-=R.b,y-=R.a,n=k+((n=l+M)<L?n:L)*g<<2,r+=z+=R.r=j[n],s+=A+=R.g=j[n+1],t+=B+=R.b=j[n+2],u+=C+=R.a=j[n+3],R=R.next,v+=D=S.r,w+=E=S.g,x+=F=S.b,y+=G=S.a,z-=D,A-=E,B-=F,C-=G,S=S.next,p+=g}return c}function f(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var a=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],b=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];return d}();HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(a,b,c){for(var d=atob(this.toDataURL(b,c).split(",")[1]),e=d.length,f=new Uint8Array(e),g=0;g<e;g++)f[g]=d.charCodeAt(g);a(new Blob([f],{type:b||"image/png"}))}});var j=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},n=function(b){if("undefined"==typeof b.dataset){var d,e,c={},f=b.attributes;for(d in f)f.hasOwnProperty(d)&&f[d].name&&/^data-[a-z_\-\d]*$/i.test(f[d].name)&&(e=o(f[d].name.substr(5)),c[e]=f[d].value);return c}return b.dataset},o=function(b){return b.replace(/\-./g,function(a){return a.charAt(1).toUpperCase()})},p=function(b){for(var c=[],d=Array.prototype.slice.call(b.attributes),e=0;e<d.length;e++)c.push({name:d[e].name,value:d[e].value})},q=function(b){return{x:"undefined"==typeof b.offsetX?b.layerX:b.offsetX,y:"undefined"==typeof b.offsetY?b.layerY:b.offsetY}},r=function(b,c){var d,e={},f=c||{};for(d in b)b.hasOwnProperty(d)&&(e[d]="undefined"==typeof f[d]?b[d]:f[d]);return e},s={ESC:27,RETURN:13},t={DOWN:["touchstart","pointerdown","mousedown"],MOVE:["touchmove","pointermove","mousemove"],UP:["touchend","touchcancel","pointerup","mouseup"]},u={jpeg:"image/jpeg",jpg:"image/jpeg",jpe:"image/jpeg",png:"image/png",gif:"image/gif",bmp:"image/bmp"},v=/(\.png|\.bmp|\.gif|\.jpg|\.jpe|\.jpg|\.jpeg)$/,x=function(b,c){var d=document.createElement(b);return c&&(d.className=c),d},y=function(b,c,d){c.forEach(function(a){b.addEventListener(a,d,!1)})},z=function(b,c,d){c.forEach(function(a){b.removeEventListener(a,d,!1)})},A=function(b){var c=b.changedTouches?b.changedTouches[0]:b;if(c)return{x:c.pageX,y:c.pageY}},B=function(b,c){var d=.5,e=.5,f=Math.PI/180*c,g=Math.cos(f),h=Math.sin(f),i=b.x,j=b.y,k=b.x+b.width,l=b.y+b.height,m=g*(i-d)+h*(j-e)+d,n=g*(j-e)-h*(i-d)+e,o=g*(k-d)+h*(l-e)+d,p=g*(l-e)-h*(k-d)+e;m<=o?(b.x=m,b.width=o-m):(b.x=o,b.width=m-o),n<=p?(b.y=n,b.height=p-n):(b.y=p,b.height=n-p)},C=function(b){var c=A(b);return c.x-=window.pageXOffset||document.documentElement.scrollLeft,c.y-=window.pageYOffset||document.documentElement.scrollTop,c},D=function(b){return b.charAt(0).toLowerCase()+b.slice(1)},E=function(b){return b.charAt(0).toUpperCase()+b.slice(1)},F=function(b){return b[b.length-1]},G=function(b,c,d){return Math.max(c,Math.min(d,b))},H=function(b,c){if(!c)return!1;for(var d=0;d<c.length;d++)if(c[d]===b)return!0;return!1},I=function(b,c,d,e,f,g){var h=new XMLHttpRequest;e&&h.upload.addEventListener("progress",function(a){e(a.loaded,a.total)}),h.open("post-a-job.html",b+"?action=custom_file_upload",!0),d&&d(h),h.onreadystatechange=function(){if(4===h.readyState&&h.status>=200&&h.status<300){var a=h.responseText;if(!a.length)return void f();if(a.indexOf("Content-Length")!==-1)return void g("file-too-big");var b=void 0;try{b=JSON.parse(h.responseText)}catch(a){}if("object"===("undefined"==typeof b?"undefined":k(b))&&"failure"===b.status)return void g(b.message);f(b||a)}else if(4===h.readyState){var c=void 0;try{c=JSON.parse(h.responseText)}catch(a){}if("object"===("undefined"==typeof c?"undefined":k(c))&&"failure"===c.status)return void g(c.message);g("fail")}},h.send(c)},J=function(b){b&&(b.style.webkitTransform="",b.style.transform="")},K=function(b){return b/1e6},M=function(){var b=[],c=void 0,d=void 0;for(c in u)u.hasOwnProperty(c)&&(d=u[c],b.indexOf(d)==-1&&b.push(d));return b},N=function(b){return"image/jpeg"===b},O=function(b){var c=void 0;for(c in u)if(u.hasOwnProperty(c)&&u[c]===b)return c;return b},P=function(b){var c=void 0;for(c in u)if(u.hasOwnProperty(c)&&b.indexOf(u[c])!==-1)return u[c];return null},Q=function(b){return b.split("index.html").pop().split("?").shift()},R=function(c){var d=arguments.length>1&&arguments[1]!==b?arguments[1]:"";return(d+c).slice(-d.length)},S=function(b){return b.getFullYear()+"-"+R(b.getMonth()+1,"00")+"-"+R(b.getDate(),"00")+"_"+R(b.getHours(),"00")+"-"+R(b.getMinutes(),"00")+"-"+R(b.getSeconds(),"00")},T=function(b){return"undefined"==typeof b.name?S(new Date)+"."+O(U(b)):b.name},U=function(b){return b.type||"image/jpeg"},V=function(b){if("string"!=typeof b)return S(new Date);var c=Q(b);return c.split(".").shift()},W=function(b,c){return b.lastModifiedDate=new Date,b.name=c,b},X=function(b){return/^data:image/.test(b)},Y=function(b,c){var d=new XMLHttpRequest;d.open("GET.html",b,!0),d.responseType="blob",d.onload=function(a){var d=Q(b),e=P(this.response.type);v.test(d)||(d+="."+O(e));var f=W(this.response,d);c(ua(f,e))},d.send()},Z=function(b){var c=b.split(",")[1],d=c.replace(/\s/g,"");return atob(d)},$=function(b,c){for(var d=Z(b),e=new ArrayBuffer(d.length),f=new Uint8Array(e),g=0;g<d.length;g++)f[g]=d.charCodeAt(g);var h=xa(b);return"undefined"==typeof c&&(c=S(new Date)+"."+O(h)),W(_(e,h),c)},_=function(b,c){var d=window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(d){var e=new d;return e.append(b),e.getBlob(c)}return new Blob([b],{type:c})},aa=function(c,d,e){var f="string"!=typeof c||0!==c.indexOf("data:image");a.parseMetaData(c,function(b){var g={canvas:!0,crossOrigin:f};d&&(g.maxWidth=d.width,g.maxHeight=d.height),b.exif&&(g.orientation=b.exif.get("Orientation")),a(c,function(a){return"error"===a.type?void e():void e(a,b)},g)})},ba=function(b,c,d){var e,f,g,h,i=c/b;return i<d?(h=c,g=h/d,e=.5*(b-g),f=0):(g=b,h=g*d,e=0,f=.5*(c-h)),{x:e,y:f,height:h,width:g}},ca=function(c){var d=arguments.length>1&&arguments[1]!==b?arguments[1]:{},e=arguments[2],f=x("canvas"),g=d.rotation,h=d.crop,i=d.size,j=d.filters;if(h){var k=g%180!==0,l={width:k?c.height:c.width,height:k?c.width:c.height},m=h.x/l.width,n=h.y/l.height,o=h.width/l.width,p=h.height/l.height;h.y+h.height>l.height&&(h.y=Math.max(0,l.height-h.height)),
h.x+h.width>l.width&&(h.x=Math.max(0,l.width-h.width)),f.width=h.width,f.height=h.height;var q=f.getContext("2d");90===g?(q.translate(.5*f.width,.5*f.height),q.rotate(-90*Math.PI/180),q.drawImage(c,(1-n)*c.width-c.width*p,h.x,h.height,h.width,.5*-f.height,.5*-f.width,f.height,f.width)):180===g?(q.translate(.5*f.width,.5*f.height),q.rotate(-180*Math.PI/180),q.drawImage(c,(1-(m+o))*l.width,(1-(n+p))*l.height,o*l.width,p*l.height,.5*-f.width,.5*-f.height,f.width,f.height)):270===g?(q.translate(.5*f.width,.5*f.height),q.rotate(-270*Math.PI/180),q.drawImage(c,h.y,(1-m)*c.height-c.height*o,h.height,h.width,.5*-f.height,.5*-f.width,f.height,f.width)):q.drawImage(c,h.x,h.y,h.width,h.height,0,0,f.width,f.height)}if(i){var r=i.width/f.width,s=i.height/f.height,t=Math.min(r,s);da(f,t),j.sharpen>0&&fa(f,ha(j.sharpen))}e(f)},ea=function(b){var c=b.getContext("2d");return c.getImageData(0,0,b.width,b.height)},fa=function(b,c){var d=b.getContext("2d");d.putImageData(c(ea(b),b.width,b.height),0,0)},ga=function(b,c,d){var e=document.createElement("canvas");e.width=b,e.height=c;var f=e.getContext("2d"),g=f.createImageData(e.width,e.height);return d&&g.set(d.data),g},ha=function(b){return function(a,c,d){for(var e=[0,-1,0,-1,5,-1,0,-1,0],f=Math.round(Math.sqrt(e.length)),g=.5*f|0,h=ga(c,d),i=h.data,j=a.data,k=d,l=void 0;k--;)for(l=c;l--;){for(var m=k,n=l,o=4*(k*c+l),p=0,q=0,r=0,s=0,t=0;t<f;t++)for(var u=0;u<f;u++){var v=m+t-g,w=n+u-g;if(v>=0&&v<d&&w>=0&&w<c){var x=4*(v*c+w),y=e[t*f+u];p+=j[x]*y,q+=j[x+1]*y,r+=j[x+2]*y,s+=j[x+3]*y}}i[o]=p*b+j[o]*(1-b),i[o+1]=q*b+j[o+1]*(1-b),i[o+2]=r*b+j[o+2]*(1-b),i[o+3]=j[o+3]}return h}},ia=function(b,c){var d=Math.abs(b.width-c.width),e=Math.abs(b.height-c.height);return Math.max(d,e)},ja=function(b){return ka(b,1)},ka=function(b,c){if(!b)return null;var d=document.createElement("canvas"),e=d.getContext("2d");return d.width=b.width,d.height=b.height,e.drawImage(b,0,0),c>0&&1!=c&&da(d,c),d},la=function(b){return b.width&&b.height},ma=function(b,c){var d=c.getContext("2d");la(c)?d.drawImage(b,0,0,c.width,c.height):(c.width=b.width,c.height=b.height,d.drawImage(b,0,0))},oa=function(b){i(b,0,0,b.width,b.height,3)},pa=function(b,c){return parseInt(b.width,10)>=c.width&&parseInt(b.height,10)>=c.height},qa=function(b,c,d){return{x:b.x*c,y:b.y*d,width:b.width*c,height:b.height*d}},ra=function(b,c,d){return{x:b.x/c,y:b.y/d,width:b.width/c,height:b.height/d}},sa=function(b){if(b&&""!==b.value){try{b.value=""}catch(a){}if(b.value){var c=document.createElement("form"),d=b.parentNode,e=b.nextSibling;c.appendChild(b),c.reset(),e?d.insertBefore(b,e):d.appendChild(b)}}},ta=function(b){return"object"===("undefined"==typeof value?"undefined":k(value))&&null!==value?JSON.parse(JSON.stringify(b)):b},ua=function(c){var d=arguments.length>1&&arguments[1]!==b?arguments[1]:null;if(!c)return null;var e=c.slice(0,c.size,d||c.type);return e.name=c.name,c.lastModifiedDate&&(e.lastModifiedDate=new Date(c.lastModifiedDate)),e},va=function(b){var c=ta(b);return c.input.file=ua(b.input.file),c.output.image=ja(b.output.image),c},wa=function(c,d,e){return c&&d?c.toDataURL(d,N(d)&&"number"==typeof e?e/100:b):null},xa=function(b){if(!b)return null;var c=b.substr(0,16).match(/^.+;/);return c.length?c[0].substring(5,c[0].length-1):null},ya=function(c){var d=arguments.length>1&&arguments[1]!==b?arguments[1]:[],e=arguments[2],f=arguments[3],g=arguments[4],h={server:ta(c.server),meta:ta(c.meta),input:{name:c.input.name,type:c.input.type,size:c.input.size,width:c.input.width,height:c.input.height,field:c.input.field}};return H("input",d)&&!g&&(h.input.image=wa(c.input.image,c.input.type)),H("output",d)&&(h.output={name:f?V(c.input.name)+"."+f:c.input.name,type:u[f]||c.input.type,width:c.output.width,height:c.output.height},h.output.image=wa(c.output.image,h.output.type,e),h.output.type=xa(h.output.image),"image/png"===h.output.type&&(h.output.name=V(h.input.name)+".png")),H("actions",d)&&(h.actions=ta(c.actions)),h},za=function(c,d,e){var f=c.output.image,g=e?V(c.input.name)+"."+e:c.input.name,h=u[e]||c.input.type;"image/png"===h&&(g=V(c.input.name)+".png"),f.toBlob(function(a){if("msSaveBlob"in window.navigator)return void window.navigator.msSaveBlob(a,g);var b=(window.URL||window.webkitURL).createObjectURL(a),c=x("a");c.style.display="none",c.download=g,c.href=b,document.body.appendChild(c),c.click(),setTimeout(function(){document.body.removeChild(c),(window.URL||window.webkitURL).revokeObjectURL(b)},0)},h,"number"==typeof d?d/100:b)},Aa=function(b,c,d){var e=d.querySelector(b);e&&(e.style.display=c?"":"none")},Ba=function(b){return Array.prototype.slice.call(b)},Ca=function(b){b.parentNode.removeChild(b)},Da=function(b){var c=x("div");return b.parentNode&&(b.nextSibling?b.parentNode.insertBefore(c,b.nextSibling):b.parentNode.appendChild(c)),c.appendChild(b),c},Ea=function(b,c,d,e){var f=(e-90)*Math.PI/180;return{x:b+d*Math.cos(f),y:c+d*Math.sin(f)}},Fa=function(b,c,d,e,f){var g=Ea(b,c,d,f),h=Ea(b,c,d,e),i=f-e<=180?"0":"1",j=["M",g.x,g.y,"A",d,d,0,i,0,h.x,h.y].join(" ");return j},Ga=function(b,c,d,e){return Fa(b,c,d,0,360*e)},Ha=function(){var a={n:function(b,c,d,e){var f,g,h,i,j,k,l,m;return h=b.y+b.height,f=G(c.y,0,h),h-f<d.min.height&&(f=h-d.min.height),j=e?(h-f)/e:b.width,j<d.min.width&&(j=d.min.width,f=h-j*e),l=.5*(j-b.width),i=b.x-l,g=b.x+b.width+l,(i<0||g>d.width)&&(m=Math.min(b.x,d.width-(b.x+b.width)),i=b.x-m,g=b.x+b.width+m,j=g-i,k=j*e,f=h-k),{x:i,y:f,width:g-i,height:h-f}},s:function(b,c,d,e){var f,g,h,i,j,k,l,m;return f=b.y,h=G(c.y,f,d.height),h-f<d.min.height&&(h=f+d.min.height),j=e?(h-f)/e:b.width,j<d.min.width&&(j=d.min.width,h=f+j*e),l=.5*(j-b.width),i=b.x-l,g=b.x+b.width+l,(i<0||g>d.width)&&(m=Math.min(b.x,d.width-(b.x+b.width)),i=b.x-m,g=b.x+b.width+m,j=g-i,k=j*e,h=f+k),{x:i,y:f,width:g-i,height:h-f}},e:function(b,c,d,e){var f,g,h,i,j,k,l,m;return i=b.x,g=G(c.x,i,d.width),g-i<d.min.width&&(g=i+d.min.width),k=e?(g-i)*e:b.height,k<d.min.height&&(k=d.min.height,g=i+k/e),l=.5*(k-b.height),f=b.y-l,h=b.y+b.height+l,(f<0||h>d.height)&&(m=Math.min(b.y,d.height-(b.y+b.height)),f=b.y-m,h=b.y+b.height+m,k=h-f,j=k/e,g=i+j),{x:i,y:f,width:g-i,height:h-f}},w:function a(b,c,d,e){var f,g,h,i,a,j,k,l;return g=b.x+b.width,i=G(c.x,0,g),g-i<d.min.width&&(i=g-d.min.width),j=e?(g-i)*e:b.height,j<d.min.height&&(j=d.min.height,i=g-j/e),k=.5*(j-b.height),f=b.y-k,h=b.y+b.height+k,(f<0||h>d.height)&&(l=Math.min(b.y,d.height-(b.y+b.height)),f=b.y-l,h=b.y+b.height+l,j=h-f,a=j/e,i=g-a),{x:i,y:f,width:g-i,height:h-f}},ne:function(b,c,d,e){var f,g,h,i,j,k,l;return i=b.x,h=b.y+b.height,g=G(c.x,i,d.width),g-i<d.min.width&&(g=i+d.min.width),k=e?(g-i)*e:G(h-c.y,d.min.height,h),k<d.min.height&&(k=d.min.height,g=i+k/e),f=b.y-(k-b.height),(f<0||h>d.height)&&(l=Math.min(b.y,d.height-(b.y+b.height)),f=b.y-l,k=h-f,j=k/e,g=i+j),{x:i,y:f,width:g-i,height:h-f}},se:function(b,c,d,e){var f,g,h,i,j,k,l;return i=b.x,f=b.y,g=G(c.x,i,d.width),g-i<d.min.width&&(g=i+d.min.width),k=e?(g-i)*e:G(c.y-b.y,d.min.height,d.height-f),k<d.min.height&&(k=d.min.height,g=i+k/e),h=b.y+b.height+(k-b.height),(f<0||h>d.height)&&(l=Math.min(b.y,d.height-(b.y+b.height)),h=b.y+b.height+l,k=h-f,j=k/e,g=i+j),{x:i,y:f,width:g-i,height:h-f}},sw:function(b,c,d,e){var f,g,h,i,j,k,l;return g=b.x+b.width,f=b.y,i=G(c.x,0,g),g-i<d.min.width&&(i=g-d.min.width),k=e?(g-i)*e:G(c.y-b.y,d.min.height,d.height-f),k<d.min.height&&(k=d.min.height,i=g-k/e),h=b.y+b.height+(k-b.height),(f<0||h>d.height)&&(l=Math.min(b.y,d.height-(b.y+b.height)),h=b.y+b.height+l,k=h-f,j=k/e,i=g-j),{x:i,y:f,width:g-i,height:h-f}},nw:function(b,c,d,e){var f,g,h,i,j,k,l;return g=b.x+b.width,h=b.y+b.height,i=G(c.x,0,g),g-i<d.min.width&&(i=g-d.min.width),k=e?(g-i)*e:G(h-c.y,d.min.height,h),k<d.min.height&&(k=d.min.height,i=g-k/e),f=b.y-(k-b.height),(f<0||h>d.height)&&(l=Math.min(b.y,d.height-(b.y+b.height)),f=b.y-l,k=h-f,j=k/e,i=g-j),{x:i,y:f,width:g-i,height:h-f}}};return function(){function c(){var a=arguments.length>0&&arguments[0]!==b?arguments[0]:document.createElement("div");l(this,c),this._element=a,this._interaction=null,this._minWidth=0,this._minHeight=0,this._ratio=null,this._rect={x:0,y:0,width:0,height:0},this._space={width:0,height:0},this._rectChanged=!1,this._init()}return j(c,[{key:"_init",value:function(){this._element.className="slim-crop-area";var c=x("div","grid");this._element.appendChild(c);for(var d in a)if(a.hasOwnProperty(d)){var e=x("button",d);this._element.appendChild(e)}var f=x("button","c");this._element.appendChild(f),y(document,t.DOWN,this)}},{key:"reset",value:function(){this._interaction=null,this._rect={x:0,y:0,width:0,height:0},this._rectChanged=!0,this._redraw(),this._element.dispatchEvent(new CustomEvent("change"))}},{key:"rescale",value:function(b){1!==b&&(this._interaction=null,this._rectChanged=!0,this._rect.x*=b,this._rect.y*=b,this._rect.width*=b,this._rect.height*=b,this._redraw(),this._element.dispatchEvent(new CustomEvent("change")))}},{key:"limit",value:function(b,c){this._space.width=b,this._space.height=c}},{key:"offset",value:function(b,c){this._space.x=b,this._space.y=c}},{key:"resize",value:function(b,c,d,e){this._interaction=null,this._rect={x:G(b,0,this._space.width-this._minWidth),y:G(c,0,this._space.height-this._minHeight),width:G(d,this._minWidth,this._space.width),height:G(e,this._minHeight,this._space.height)},this._rectChanged=!0,this._redraw(),this._element.dispatchEvent(new CustomEvent("change"))}},{key:"handleEvent",value:function(b){switch(b.type){case"touchstart":case"pointerdown":case"mousedown":this._onStartDrag(b);break;case"touchmove":case"pointermove":case"mousemove":this._onDrag(b);break;case"touchend":case"touchcancel":case"pointerup":case"mouseup":this._onStopDrag(b)}}},{key:"_onStartDrag",value:function(b){this._element.contains(b.target)&&(b.preventDefault(),y(document,t.MOVE,this),y(document,t.UP,this),this._interaction={type:b.target.className,offset:C(b)},this._interaction.offset.x-=this._rect.x,this._interaction.offset.y-=this._rect.y,this._element.setAttribute("data-dragging","true"),this._redraw())}},{key:"_onDrag",value:function(c){c.preventDefault();var d=C(c),e=this._interaction.type;"c"===e?(this._rect.x=G(d.x-this._interaction.offset.x,0,this._space.width-this._rect.width),this._rect.y=G(d.y-this._interaction.offset.y,0,this._space.height-this._rect.height)):a[e]&&(this._rect=a[e](this._rect,{x:d.x-this._space.x,y:d.y-this._space.y},{x:0,y:0,width:this._space.width,height:this._space.height,min:{width:this._minWidth,height:this._minHeight}},this._ratio)),this._rectChanged=!0,this._element.dispatchEvent(new CustomEvent("input"))}},{key:"_onStopDrag",value:function(b){b.preventDefault(),z(document,t.MOVE,this),z(document,t.UP,this),this._interaction=null,this._element.setAttribute("data-dragging","false"),this._element.dispatchEvent(new CustomEvent("change"))}},{key:"_redraw",value:function(){var b=this;if(this._rectChanged){var c="translate("+this._rect.x+"px,"+this._rect.y+"px);";this._element.style.cssText="\n\t\t\t\t\t-webkit-transform: "+c+";\n\t\t\t\t\ttransform: "+c+";\n\t\t\t\t\twidth:"+this._rect.width+"px;\n\t\t\t\t\theight:"+this._rect.height+"px;\n\t\t\t\t",this._rectChanged=!1}this._interaction&&requestAnimationFrame(function(){return b._redraw()})}},{key:"destroy",value:function(){this._interaction=!1,this._rectChanged=!1,z(document,t.DOWN,this),z(document,t.MOVE,this),z(document,t.UP,this),Ca(this._element)}},{key:"element",get:function(){return this._element}},{key:"space",get:function(){return this._space}},{key:"area",get:function(){var b=this._rect.x/this._space.width,c=this._rect.y/this._space.height,d=this._rect.width/this._space.width,e=this._rect.height/this._space.height;return{x:b,y:c,width:d,height:e}}},{key:"dirty",get:function(){return 0!==this._rect.x||0!==this._rect.y||0!==this._rect.width||0!==this._rect.height}},{key:"minWidth",set:function(b){this._minWidth=b}},{key:"minHeight",set:function(b){this._minHeight=b}},{key:"ratio",set:function(b){this._ratio=b}}]),c}()}(),Ia=function(){var a=["input","change"],c=function(){function c(){var a=arguments.length>0&&arguments[0]!==b?arguments[0]:document.createElement("div"),d=arguments.length>1&&arguments[1]!==b?arguments[1]:{};l(this,c),this._element=a,this._options=r(c.options(),d),this._ratio=null,this._output=null,this._input=null,this._preview=null,this._previewBlurred=null,this._blurredPreview=!1,this._cropper=null,this._straightCrop=null,this._previewWrapper=null,this._currentWindowSize={},this._btnGroup=null,this._maskFrame=null,this._dirty=!1,this._wrapperRotation=0,this._wrapperScale=1,this._init()}return j(c,[{key:"_init",value:function(){var d=this;this._element.className="slim-image-editor",this._container=x("div","slim-container"),this._wrapper=x("div","slim-wrapper"),this._stage=x("div","slim-stage"),this._container.appendChild(this._stage),this._cropper=new Ha,a.forEach(function(a){d._cropper.element.addEventListener(a,d)}),this._stage.appendChild(this._cropper.element),this._previewWrapper=x("div","slim-image-editor-preview slim-crop-preview"),this._previewBlurred=x("canvas","slim-crop-blur"),this._previewWrapper.appendChild(this._previewBlurred),this._wrapper.appendChild(this._previewWrapper),this._previewMask=x("div","slim-crop-mask"),this._preview=x("img"),this._previewMask.appendChild(this._preview),this._cropper.element.appendChild(this._previewMask),this._btnGroup=x("div","slim-editor-btn-group"),c.Buttons.forEach(function(a){var b=E(a),c=d._options["button"+b+"Label"],e=d._options["button"+b+"Title"],f=d._options["button"+b+"ClassName"],g=x("button","slim-editor-btn slim-btn-"+a+(f?" "+f:""));g.innerHTML=c,g.title=e||c,g.type="button",g.setAttribute("data-action",a),g.addEventListener("click",d),d._btnGroup.appendChild(g)}),this._utilsGroup=x("div","slim-editor-utils-group");var e=x("button","slim-editor-utils-btn slim-btn-rotate"+(this._options.buttonRotateClassName?" "+this._options.buttonRotateClassName:""));e.setAttribute("data-action","rotate"),e.addEventListener("click",this),e.title=this._options.buttonRotateTitle,this._utilsGroup.appendChild(e),this._container.appendChild(this._wrapper),this._element.appendChild(this._container),this._element.appendChild(this._utilsGroup),this._element.appendChild(this._btnGroup)}},{key:"dirty",value:function(){this._dirty=!0}},{key:"handleEvent",value:function(b){switch(b.type){case"click":this._onClick(b);break;case"change":this._onGridChange(b);break;case"input":this._onGridInput(b);break;case"keydown":this._onKeyDown(b);break;case"resize":this._onResize(b)}}},{key:"_onKeyDown",value:function(b){switch(b.keyCode){case s.RETURN:this._confirm();break;case s.ESC:this._cancel()}}},{key:"_onClick",value:function(b){b.target.classList.contains("slim-btn-cancel")&&this._cancel(),b.target.classList.contains("slim-btn-confirm")&&this._confirm(),b.target.classList.contains("slim-btn-rotate")&&this._rotate()}},{key:"_onResize",value:function(){this._currentWindowSize={width:window.innerWidth,height:window.innerHeight},this._redraw(),this._redrawCropper(this._cropper.area),this._updateWrapperScale(),this._redrawWrapper()}},{key:"_redrawWrapper",value:function(){var b=h.createMatrix();b.scale(this._wrapperScale,this._wrapperScale),b.rotateZ(this._wrapperRotation*(Math.PI/180)),h.setElementTransform(this._previewWrapper,b)}},{key:"_onGridInput",value:function(){this._redrawCropMask()}},{key:"_onGridChange",value:function(){this._redrawCropMask()}},{key:"_updateWrapperRotation",value:function(){this._options.minSize.width>this._input.height||this._options.minSize.height>this._input.width?this._wrapperRotation+=180:this._wrapperRotation+=90}},{key:"_updateWrapperScale",value:function(){var b=this._wrapperRotation%180!==0;if(b){var c=this._container.offsetWidth,d=this._container.offsetHeight,e=this._wrapper.offsetHeight,f=this._wrapper.offsetWidth,g=c/e;g*f>d&&(g=d/f),this._wrapperScale=g}else this._wrapperScale=1}},{key:"_cancel",value:function(){this._element.dispatchEvent(new CustomEvent("cancel"))}},{key:"_confirm",value:function(){var b=this._wrapperRotation%180!==0,c=this._cropper.area,d=qa(c,b?this._input.height:this._input.width,b?this._input.width:this._input.height);this._element.dispatchEvent(new CustomEvent("confirm",{detail:{rotation:this._wrapperRotation%360,crop:d}}))}},{key:"_rotate",value:function(){var b=this;this._updateWrapperRotation();var c=1===this.ratio||null===this._ratio?this._cropper.area:null;c&&B(c,90),this._updateWrapperScale(),this._hideCropper(),h(this._previewWrapper,{rotation:[0,0,this._wrapperRotation*(Math.PI/180)],scale:[this._wrapperScale,this._wrapperScale],easing:"spring",springConstant:.8,springDeceleration:.65,complete:function(){b._redrawCropper(c),b._showCropper()}})}},{key:"_showCropper",value:function(){h(this._stage,{easing:"ease",duration:250,fromOpacity:0,opacity:1})}},{key:"_hideCropper",value:function(){h(this._stage,{duration:0,fromOpacity:0,opacity:0})}},{key:"_redrawCropMask",value:function(){var b=this,c=this._wrapperRotation%360,d=this._wrapperScale,e={width:this._wrapper.offsetWidth,height:this._wrapper.offsetHeight},f=this._cropper.area,g={x:0,y:0};0===c?(g.x=-f.x,g.y=-f.y):90===c?(g.x=-(1-f.y),g.y=-f.x):180===c?(g.x=-(1-f.x),g.y=-(1-f.y)):270===c&&(g.x=-f.y,g.y=-(1-f.x)),g.x*=e.width,g.y*=e.height,cancelAnimationFrame(this._maskFrame),this._maskFrame=requestAnimationFrame(function(){var a="scale("+d+") rotate("+-c+"deg) translate("+g.x+"px, "+g.y+"px);";b._preview.style.cssText="\n\t\t\t\t\twidth: "+b._previewSize.width+"px;\n\t\t\t\t\theight: "+b._previewSize.height+"px;\n\t\t\t\t\t-webkit-transform: "+a+";\n\t\t\t\t\ttransform: "+a+";\n\t\t\t\t"})}},{key:"open",value:function(b,c,d,e,f){var g=this;if(this._input&&!this._dirty&&this._ratio===c)return void f();this._currentWindowSize={width:window.innerWidth,height:window.innerHeight},this._dirty=!1,this._wrapperRotation=e||0,this._blurredPreview=!1,this._ratio=c,this._previewSize=null,this._element.style.opacity="0",this._input=b;var h=e%180!==0,i=ra(d,h?b.height:b.width,h?b.width:b.height);this._preview.onload=function(){g._preview.onload=null,g._cropper.ratio=g.ratio,g._redraw(),g._redrawCropper(i),f(),g._element.style.opacity=""},this._preview.src=ka(this._input,Math.min(this._container.offsetWidth/this._input.width,this._container.offsetHeight/this._input.height)).toDataURL()}},{key:"_redrawCropper",value:function(b){var c=this._wrapperRotation%180!==0,d=c?this._input.height/this._input.width:this._input.width/this._input.height,e=this._wrapper.offsetWidth,f=this._wrapper.offsetHeight,g=this._container.offsetWidth,h=this._container.offsetHeight;this._updateWrapperScale();var i=this._wrapperScale*(c?f:e),j=this._wrapperScale*(c?e:f),k=c?.5*(g-i):this._wrapper.offsetLeft,l=c?.5*(h-j):this._wrapper.offsetTop;this._stage.style.cssText="\n\t\t\t\tleft:"+k+"px;\n\t\t\t\ttop:"+l+"px;\n\t\t\t\twidth:"+i+"px;\n\t\t\t\theight:"+j+"px;\n\t\t\t",this._cropper.limit(i,i/d),this._cropper.offset(k+this._element.offsetLeft,l+this._element.offsetTop),this._cropper.minWidth=this._wrapperScale*this._options.minSize.width*this.scalar,this._cropper.minHeight=this._wrapperScale*this._options.minSize.height*this.scalar;var m=null;m=b?{x:b.x*i,y:b.y*j,width:b.width*i,height:b.height*j}:ba(i,j,this._ratio||j/i),this._cropper.resize(m.x,m.y,m.width,m.height)}},{key:"_redraw",value:function(){var b=this._input.height/this._input.width,c=this._container.clientWidth,d=this._container.clientHeight,e=c,f=e*b;f>d&&(f=d,e=f/b),e=Math.round(e),f=Math.round(f);var g=(c-e)/2,h=(d-f)/2;this._wrapper.style.cssText="\n\t\t\t\tleft:"+g+"px;\n\t\t\t\ttop:"+h+"px;\n\t\t\t\twidth:"+e+"px;\n\t\t\t\theight:"+f+"px;\n\t\t\t",this._previewBlurred.style.cssText="\n\t\t\t\twidth:"+e+"px;\n\t\t\t\theight:"+f+"px;\n\t\t\t",this._preview.style.cssText="\n\t\t\t\twidth:"+e+"px;\n\t\t\t\theight:"+f+"px;\n\t\t\t",this._previewSize={width:e,height:f},this._blurredPreview||(this._previewBlurred.width=300,this._previewBlurred.height=this._previewBlurred.width*b,ma(this._input,this._previewBlurred),oa(this._previewBlurred,3),this._blurredPreview=!0)}},{key:"show",value:function(){var c=arguments.length>0&&arguments[0]!==b?arguments[0]:function(){};this._currentWindowSize.width===window.innerWidth&&this._currentWindowSize.height===window.innerHeight||(this._redraw(),this._redrawCropper(this._cropper.area)),document.addEventListener("keydown",this),window.addEventListener("resize",this);var d=this._wrapperRotation*(Math.PI/180);h(this._previewWrapper,{fromRotation:[0,0,d],rotation:[0,0,d],fromPosition:[0,0,0],position:[0,0,0],fromOpacity:0,opacity:1,fromScale:[this._wrapperScale-.02,this._wrapperScale-.02],scale:[this._wrapperScale,this._wrapperScale],easing:"spring",springConstant:.3,springDeceleration:.85,delay:450,complete:function(){}}),this._cropper.dirty?h(this._stage,{fromPosition:[0,0,0],position:[0,0,0],fromOpacity:0,opacity:1,duration:250,delay:850,complete:function(){J(this),c()}}):h(this._stage,{fromPosition:[0,0,0],position:[0,0,0],fromOpacity:0,opacity:1,duration:250,delay:1e3,complete:function(){J(this)}}),h(this._btnGroup.childNodes,{fromScale:[.9,.9],scale:[1,1],fromOpacity:0,opacity:1,delay:function(b){return 1e3+100*b},easing:"spring",springConstant:.3,springDeceleration:.85,complete:function(){J(this)}}),h(this._utilsGroup.childNodes,{fromScale:[.9,.9],scale:[1,1],fromOpacity:0,opacity:1,easing:"spring",springConstant:.3,springDeceleration:.85,delay:1250,complete:function(){J(this)}})}},{key:"hide",value:function(){var c=arguments.length>0&&arguments[0]!==b?arguments[0]:function(){};document.removeEventListener("keydown",this),window.removeEventListener("resize",this),h(this._utilsGroup.childNodes,{fromOpacity:1,opacity:0,duration:250}),h(this._btnGroup.childNodes,{fromOpacity:1,opacity:0,delay:200,duration:350}),h([this._stage,this._previewWrapper],{fromPosition:[0,0,0],position:[0,-250,0],fromOpacity:1,opacity:0,easing:"spring",springConstant:.3,springDeceleration:.75,delay:250,allDone:function(){c()}})}},{key:"destroy",value:function(){var c=this;Ba(this._btnGroup.children).forEach(function(a){a.removeEventListener("click",c)}),a.forEach(function(a){c._cropper.element.removeEventListener(a,c)}),this._cropper.destroy(),this._element.parentNode&&Ca(this._element)}},{key:"showRotateButton",set:function(b){b?this._element.classList.remove("slim-rotation-disabled"):this._element.classList.add("slim-rotation-disabled")}},{key:"element",get:function(){return this._element}},{key:"ratio",get:function(){return"input"===this._ratio?this._input.height/this._input.width:this._ratio}},{key:"offset",get:function(){return this._element.getBoundingClientRect()}},{key:"original",get:function(){return this._input}},{key:"scalar",get:function(){return this._previewSize.width/this._input.width}}],[{key:"options",value:function(){return{buttonCancelClassName:null,buttonConfirmClassName:null,buttonCancelLabel:"Cancel",buttonConfirmLabel:"Confirm",buttonCancelTitle:null,buttonConfirmTitle:null,buttonRotateTitle:"Rotate",buttonRotateClassName:null,minSize:{width:0,height:0}}}}]),c}();return c.Buttons=["cancel","confirm"],c}(Ha),Ja=function(){var a=["dragover","dragleave","drop"];return function(){function c(){var a=arguments.length>0&&arguments[0]!==b?arguments[0]:document.createElement("div");l(this,c),this._element=a,this._accept=[],this._dragPath=null,this._init()}return j(c,[{key:"isValidDataTransfer",value:function(b){return b.files.length?this.areValidDataTransferFiles(b.files):this.areValidDataTransferItems(b.items)}},{key:"areValidDataTransferFiles",value:function(b){return!this._accept.length||!b||this._accept.indexOf(b[0].type)!==-1}},{key:"areValidDataTransferItems",value:function(b){return!this._accept.length||!b||(b[0].type&&0===b[0].type.indexOf("application")?null:this._accept.indexOf(b[0].type)!==-1)}},{key:"reset",value:function(){this._element.files=null}},{key:"_init",value:function(){var c=this;this._element.className="slim-file-hopper",a.forEach(function(a){c._element.addEventListener(a,c)})}},{key:"handleEvent",value:function(b){switch(b.type){case"dragover":this._onDragOver(b);break;case"dragleave":this._onDragLeave(b);break;case"drop":this._onDrop(b)}}},{key:"_onDrop",value:function(b){b.preventDefault();var c=this.isValidDataTransfer(b.dataTransfer);return c?(this._element.files=b.dataTransfer.files,this._element.dispatchEvent(new CustomEvent("file-drop",{detail:q(b)})),this._element.dispatchEvent(new CustomEvent("change")),void(this._dragPath=null)):(this._element.dispatchEvent(new CustomEvent("file-invalid-drop")),void(this._dragPath=null))}},{key:"_onDragOver",value:function(b){b.preventDefault(),b.dataTransfer.dropEffect="copy";var c=this.isValidDataTransfer(b.dataTransfer);return null===c||c?(this._dragPath||(this._dragPath=[]),this._dragPath.push(q(b)),void this._element.dispatchEvent(new CustomEvent("file-over",{detail:{x:F(this._dragPath).x,y:F(this._dragPath).y}}))):(b.dataTransfer.dropEffect="none",void this._element.dispatchEvent(new CustomEvent("file-invalid")))}},{key:"_onDragLeave",value:function(b){this._element.dispatchEvent(new CustomEvent("file-out",{detail:q(b)})),this._dragPath=null}},{key:"destroy",value:function(){var c=this;a.forEach(function(a){c._element.removeEventListener(a,c)}),Ca(this._element),this._element=null,this._dragPath=null,this._accept=null}},{key:"element",get:function(){return this._element}},{key:"dragPath",get:function(){return this._dragPath}},{key:"enabled",get:function(){return""===this._element.style.display},set:function(b){this._element.style.display=b?"":"none"}},{key:"accept",set:function(b){this._accept=b},get:function(){return this._accept}}]),c}()}(),Ka=function(){return function(){function a(){l(this,a),this._element=null,this._inner=null,this._init()}return j(a,[{key:"_init",value:function(){this._element=x("div","slim-popover"),this._element.setAttribute("data-state","off"),document.body.appendChild(this._element)}},{key:"show",value:function(){var c=this,d=arguments.length>0&&arguments[0]!==b?arguments[0]:function(){};this._element.setAttribute("data-state","on"),h(this._element,{fromOpacity:0,opacity:1,duration:350,complete:function(){J(c._element),d()}})}},{key:"hide",value:function(){var c=this,d=arguments.length>0&&arguments[0]!==b?arguments[0]:function(){};h(this._element,{fromOpacity:1,opacity:0,duration:500,complete:function(){J(c._element),c._element.setAttribute("data-state","off"),d()}})}},{key:"destroy",value:function(){this._element.parentNode&&(this._element.parentNode.removeChild(this._element),this._element=null,this._inner=null)}},{key:"inner",set:function(b){this._inner=b,this._element.firstChild&&this._element.removeChild(this._element.firstChild),this._element.appendChild(this._inner)}}]),a}()}(),La=function(b,c){return b.split(c).map(function(a){return parseInt(a,10)})},Ma=function(b){return"DIV"===b.nodeName},Na={AUTO:"auto",INITIAL:"initial",MANUAL:"manual"},Oa=["x","y","width","height"],Pa=["file-invalid-drop","file-invalid","file-drop","file-over","file-out","click"],Qa=["cancel","confirm"],Ra=["remove","edit","download","upload"],Sa=null,Ta=0,Ua='\n<div class="slim-loader">\n\t<svg>\n\t\t<path class="slim-loader-background" fill="none" stroke-width="3" />\n\t\t<path class="slim-loader-foreground" fill="none" stroke-width="3" />\n\t</svg>\n</div>\n',Va='\n<div class="slim-upload-status"></div>\n',Wa=function(b){var c=b.split(",");return{width:parseInt(c[0],10),height:parseInt(c[1],10)}},Xa=function(){function a(c){var d=arguments.length>1&&arguments[1]!==b?arguments[1]:{};l(this,a),Sa||(Sa=new Ka),this._uid=Ta++,this._options=r(a.options(),d),this._options.forceSize&&("string"==typeof this._options.forceSize&&(this._options.forceSize=Wa(this._options.forceSize)),this._options.ratio=this._options.forceSize.width+":"+this._options.forceSize.height,this._options.size=ta(this._options.forceSize)),"string"==typeof this._options.size&&(this._options.size=Wa(this._options.size)),"string"==typeof this._options.minSize&&(this._options.minSize=Wa(this._options.minSize)),this._originalElement=c,this._originalElementInner=c.innerHTML,this._originalElementAttributes=p(c),Ma(c)?this._element=c:(this._element=Da(c),this._element.className=c.className,c.className="",this._element.setAttribute("data-ratio",this._options.ratio)),this._element.classList.add("slim"),this._element.setAttribute("data-state","init"),this._state=[],this._timers=[],this._input=null,this._inputReference=null,this._output=null,this._ratio=null,this._isRequired=!1,this._imageHopper=null,this._imageEditor=null,this._progressEnabled=!0,this._data={},this._resetData(),this._drip=null,this._hasInitialImage=!1,this._initialCrop=this._options.crop,this._initialRotation=this._options.rotation&&this._options.rotation%90===0?this._options.rotation:null,this._isBeingDestroyed=!1,a.supported?this._init():this._fallback()}return j(a,[{key:"setRotation",value:function(b,c){if("number"==typeof b||b%90===0){this._data.actions.rotation=b;var d=this._data.actions.rotation%180!==0;if(this._data.input.image){var e=d?this._data.input.image.height:this._data.input.image.width,f=d?this._data.input.image.width:this._data.input.image.height;this._data.actions.crop=ba(e,f,this._ratio),this._data.actions.crop.type=Na.AUTO}this._data.input.image&&c&&this._manualTransform(c)}}},{key:"setSize",value:function(b,c){"string"==typeof b&&(b=Wa(b)),b&&b.width&&b.height&&(this._options.size=ta(b),this._data.actions.size=ta(b),this._data.input.image&&c&&this._manualTransform(c))}},{key:"setRatio",value:function(b,c){var d=this;if(b&&"string"==typeof b&&(this._options.ratio=b,this._isFixedRatio())){var e=La(this._options.ratio,":");this._ratio=e[1]/e[0],this._data.input.image&&c?this._cropAuto(function(a){d._scaleDropArea(d._ratio),c&&c(a)}):(this._data.input.image&&(this._data.actions.crop=ba(this._data.input.image.width,this._data.input.image.height,this._ratio),this._data.actions.crop.type=Na.AUTO),this._scaleDropArea(this._ratio),c&&c(null))}}},{key:"isAttachedTo",value:function(b){return this._element===b||this._originalElement===b}},{key:"isDetached",value:function(){return null===this._element.parentNode}},{key:"load",value:function(c){var d=arguments.length>1&&arguments[1]!==b?arguments[1]:{},e=arguments[2];"function"==typeof d?e=d:(this._options.crop=d.crop,this._options.rotation=d.rotation,this._initialRotation=d.rotation&&d.rotation%90===0?d.rotation:null,this._initialCrop=this._options.crop),this._load(c,e)}},{key:"upload",value:function(b){this._doUpload(b)}},{key:"download",value:function(){this._doDownload()}},{key:"remove",value:function(){return this._doRemove()}},{key:"destroy",value:function(){this._doDestroy()}},{key:"edit",value:function(){this._doEdit()}},{key:"crop",value:function(b,c){this._crop(b.x,b.y,b.width,b.height,c)}},{key:"_canInstantEdit",value:function(){return this._options.instantEdit&&!this._isInitialising}},{key:"_getFileInput",value:function(){return this._element.querySelector("input[type=file]")}},{key:"_getInitialImage",value:function(){return this._element.querySelector("img")}},{key:"_getInputElement",value:function(){return this._getFileInput()||this._getInitialImage()}},{key:"_getRatioSpacerElement",value:function(){return this._element.children[0]}},{key:"_isImageOnly",value:function(){return"INPUT"!==this._input.nodeName}},{key:"_isFixedRatio",value:function(){return this._options.ratio.indexOf(":")!==-1}},{key:"_isAutoCrop",value:function(){return this._data.actions.crop.type===Na.AUTO}},{key:"_toggleButton",value:function(b,c){Aa('.slim-btn[data-action="'+b+'"]',c,this._element)}},{key:"_clearState",value:function(){this._state=[],this._updateState()}},{key:"_removeState",value:function(b){this._state=this._state.filter(function(a){return a!==b}),this._updateState()}},{key:"_addState",value:function(b){H(b,this._state)||(this._state.push(b),this._updateState())}},{key:"_updateState",value:function(){this._element&&this._element.setAttribute("data-state",this._state.join(","));
}},{key:"_resetData",value:function(){this._data={server:null,meta:ta(this._options.meta),input:{field:this._inputReference,name:null,type:null,width:0,height:0,file:null},output:{image:null,width:0,height:0},actions:{rotation:null,crop:null,size:null}},this._output&&(this._output.value=""),sa(this._getFileInput())}},{key:"_init",value:function(){var b=this;this._isInitialising=!0,this._addState("empty"),H("input",this._options.post)&&(this._inputReference="slim_input_"+this._uid),this._input=this._getInputElement(),this._input||(this._input=x("input"),this._input.type="file",this._element.appendChild(this._input)),this._isRequired=this._input.required===!0,this._output=this._element.querySelector("input[type=hidden]"),this._output||(this._output=x("input"),this._output.type="hidden",this._output.name=this._input.name||this._options.defaultInputName,this._element.appendChild(this._output)),this._input.removeAttribute("name");var c=x("div","slim-area"),d=this._getInitialImage(),e=(d||{}).src;e?this._hasInitialImage=!0:(this._initialCrop=null,this._initialRotation=null);var f='\n\t\t<div class="slim-result">\n\t\t\t<img class="in" style="opacity:0" '+(e?'src="'+e+'"':"")+'><img><img style="opacity:0">\n\t\t</div>';if(this._isImageOnly())c.innerHTML="\n\t\t\t\t"+Ua+"\n\t\t\t\t"+Va+"\n\t\t\t\t"+f+"\n\t\t\t";else{H("input",this._options.post)&&(this._data.input.field=this._inputReference,this._options.service||(this._input.name=this._inputReference));var g=void 0;this._input.hasAttribute("accept")&&"image/*"!==this._input.getAttribute("accept")?g=this._input.accept.split(",").map(function(a){return a.trim()}).filter(function(a){return a.length>0}):(g=M(),this._input.setAttribute("accept",g.join(","))),this._imageHopper=new Ja,this._imageHopper.accept=g,this._element.appendChild(this._imageHopper.element),Pa.forEach(function(a){b._imageHopper.element.addEventListener(a,b)}),c.innerHTML="\n\t\t\t\t"+Ua+"\n\t\t\t\t"+Va+'\n\t\t\t\t<div class="slim-drip"><span><span></span></span></div>\n\t\t\t\t<div class="slim-status"><div class="slim-label">'+(this._options.label||"")+'</div><div class="slim-label-loading">'+(this._options.labelLoading||"")+"</div></div>\n\t\t\t\t"+f+"\n\t\t\t",this._input.addEventListener("change",this)}if(this._element.appendChild(c),this._btnGroup=x("div","slim-btn-group"),this._btnGroup.style.display="none",this._element.appendChild(this._btnGroup),Ra.filter(function(a){return b._isButtonAllowed(a)}).forEach(function(a){var c=E(a),d=b._options["button"+c+"Label"],e=b._options["button"+c+"Title"]||d,f=b._options["button"+c+"ClassName"],g=x("button","slim-btn slim-btn-"+a+(f?" "+f:""));g.innerHTML=d,g.title=e,g.type="button",g.addEventListener("click",b),g.setAttribute("data-action",a),b._btnGroup.appendChild(g)}),this._isFixedRatio()){var h=La(this._options.ratio,":");this._ratio=h[1]/h[0],this._scaleDropArea(this._ratio)}this._updateProgress(.5),e?this._load(e,function(){b._onInit()}):this._onInit()}},{key:"_onInit",value:function(){var b=this;this._isInitialising=!1;var c=function(){var c=setTimeout(function(){b._options.didInit.apply(b,[b.data])},0);b._timers.push(c)};this._options.saveInitialImage&&null!==this._data.input.name?this._options.service||this._save(function(){c()},!1):(this._options.service&&null!==this._data.input.name&&this._toggleButton("upload",!1),c())}},{key:"_updateProgress",value:function(b){if(b=Math.min(.99999,b),this._element&&this._progressEnabled){var c=this._element.querySelector(".slim-loader");if(c){var d=c.offsetWidth,e=c.querySelectorAll("path"),f=parseInt(e[0].getAttribute("stroke-width"),10);e[0].setAttribute("d",Ga(.5*d,.5*d,.5*d-f,.9999)),e[1].setAttribute("d",Ga(.5*d,.5*d,.5*d-f,b))}}}},{key:"_startProgress",value:function(b){var c=this;if(this._element){this._progressEnabled=!1;var d=this._element.querySelector(".slim-loader");if(d){var e=d.children[0];this._stopProgressLoop(function(){d.removeAttribute("style"),e.removeAttribute("style"),c._progressEnabled=!0,c._updateProgress(0),c._progressEnabled=!1,h(e,{fromOpacity:0,opacity:1,duration:250,complete:function(){c._progressEnabled=!0,b&&b()}})})}}}},{key:"_stopProgress",value:function(){var b=this;if(this._element){var c=this._element.querySelector(".slim-loader");if(c){var d=c.children[0];this._updateProgress(1),h(d,{fromOpacity:1,opacity:0,duration:250,complete:function(){c.removeAttribute("style"),d.removeAttribute("style"),b._updateProgress(.5),b._progressEnabled=!1}})}}}},{key:"_startProgressLoop",value:function(){if(this._element){var b=this._element.querySelector(".slim-loader");if(b){var c=b.children[0];b.removeAttribute("style"),c.removeAttribute("style"),this._updateProgress(.5);var d=1e3;h(b,"stop"),h(b,{rotation:[0,0,-(2*Math.PI)*d],easing:"linear",duration:1e3*d}),h(c,{fromOpacity:0,opacity:1,duration:250})}}}},{key:"_stopProgressLoop",value:function(b){if(this._element){var c=this._element.querySelector(".slim-loader");if(c){var d=c.children[0];h(d,{fromOpacity:parseFloat(d.style.opacity),opacity:0,duration:250,complete:function(){h(c,"stop"),c.removeAttribute("style"),d.removeAttribute("style"),b&&b()}})}}}},{key:"_isButtonAllowed",value:function(b){return"edit"===b?this._options.edit:"download"===b?this._options.download:"upload"===b?!!this._options.service&&!this._options.push:"remove"!==b||!this._isImageOnly()}},{key:"_fallback",value:function(){var b=x("div","slim-area");b.innerHTML='\n\t\t\t<div class="slim-status"><div class="slim-label">'+(this._options.label||"")+"</div></div>\n\t\t",this._element.appendChild(b),this._throwError(this._options.statusNoSupport)}},{key:"handleEvent",value:function(b){switch(b.type){case"click":this._onClick(b);break;case"change":this._onChange(b);break;case"cancel":this._onCancel(b);break;case"confirm":this._onConfirm(b);break;case"file-over":this._onFileOver(b);break;case"file-out":this._onFileOut(b);break;case"file-drop":this._onDropFile(b);break;case"file-invalid":this._onInvalidFile(b);break;case"file-invalid-drop":this._onInvalidFileDrop(b)}}},{key:"_getIntro",value:function(){return this._element.querySelector(".slim-result .in")}},{key:"_getOutro",value:function(){return this._element.querySelector(".slim-result .out")}},{key:"_getInOut",value:function(){return this._element.querySelectorAll(".slim-result img")}},{key:"_getDrip",value:function(){return this._drip||(this._drip=this._element.querySelector(".slim-drip > span")),this._drip}},{key:"_throwError",value:function(b){this._addState("error"),this._element.querySelector(".slim-label").style.display="none";var c=this._element.querySelector(".slim-error");c||(c=x("div","slim-error"),this._element.querySelector(".slim-status").appendChild(c)),c.innerHTML=b}},{key:"_removeError",value:function(){this._removeState("error"),this._element.querySelector(".slim-label").style.display="";var b=this._element.querySelector(".slim-error");b&&b.parentNode.removeChild(b)}},{key:"_openFileDialog",value:function(){this._removeError(),this._input.click()}},{key:"_onClick",value:function(b){var c=this,d=b.target.classList,e=b.target;if(d.contains("slim-file-hopper"))return void this._openFileDialog();switch(e.getAttribute("data-action")){case"remove":this._options.willRemove.apply(this,[this.data,function(){c._doRemove()}]);break;case"edit":this._doEdit();break;case"download":this._doDownload();break;case"upload":this._doUpload()}}},{key:"_onInvalidFileDrop",value:function(){this._onInvalidFile(),this._removeState("file-over");var b=this._getDrip();h(b.firstChild,{fromScale:[.5,.5],scale:[0,0],fromOpacity:.5,opacity:0,duration:150,complete:function(){J(b.firstChild)}})}},{key:"_onInvalidFile",value:function(){var b=this._imageHopper.accept.map(O),c=this._options.statusFileType.replace("$0",b.join(", "));this._throwError(c)}},{key:"_onImageTooSmall",value:function(){var b=this._options.statusImageTooSmall.replace("$0",this._options.minSize.width+" × "+this._options.minSize.height);this._throwError(b)}},{key:"_onOverWeightFile",value:function(){var b=this._options.statusFileSize.replace("$0",this._options.maxFileSize);this._throwError(b)}},{key:"_onFileOver",value:function(b){this._addState("file-over"),this._removeError();var c=this._getDrip(),d=h.createMatrix();d.translate(b.detail.x,b.detail.y,0),h.setElementTransform(c,d),1==this._imageHopper.dragPath.length&&(c.style.opacity=1,h(c.firstChild,{fromOpacity:0,opacity:.5,fromScale:[0,0],scale:[.5,.5],duration:150}))}},{key:"_onFileOut",value:function(b){this._removeState("file-over"),this._removeState("file-invalid"),this._removeError();var c=this._getDrip(),d=h.createMatrix();d.translate(b.detail.x,b.detail.y,0),h.setElementTransform(c,d),h(c.firstChild,{fromScale:[.5,.5],scale:[0,0],fromOpacity:.5,opacity:0,duration:150,complete:function(){J(c.firstChild)}})}},{key:"_onDropFile",value:function(b){var c=this;this._removeState("file-over");var d=this._getDrip(),e=h.createMatrix();e.translate(b.detail.x,b.detail.y,0),h.setElementTransform(d,e);var f=this._imageHopper.dragPath.length,g=this._imageHopper.dragPath[f-Math.min(10,f)],i=b.detail.x-g.x,j=b.detail.y-g.y;h(d,{fromPosition:[b.detail.x,b.detail.y,0],position:[b.detail.x+i,b.detail.y+j,0],duration:200}),h(d.firstChild,{fromScale:[.5,.5],scale:[2,2],fromOpacity:1,opacity:0,duration:200,complete:function(){J(d.firstChild),c._load(b.target.files[0])}})}},{key:"_onChange",value:function(b){this._load(b.target.files[0])}},{key:"_load",value:function(b,c){var d=this;if(!this._isBeingDestroyed){this._removeState("empty"),this._addState("busy"),this._startProgressLoop(),this._imageHopper&&(this._imageHopper.enabled=!1),clearTimeout(this._loadTimeout);var e=function(){clearTimeout(d._loadTimeout),d._loadTimeout=setTimeout(function(){d._isBeingDestroyed||(d._addState("loading"),h(d._element.querySelector(".slim-label-loading"),{fromOpacity:0,opacity:1,duration:250}))},500)},f=function(){d._imageHopper&&(d._imageHopper.enabled=!0),d._removeState("loading"),d._removeState("busy"),d._addState("empty"),d._stopProgressLoop()};if("string"==typeof b)return void(X(b)?this._load($(b),c):(e(),Y(b,function(a){d._load(a,c)})));var g=b;if(this._imageHopper&&this._imageHopper.accept.indexOf(g.type)===-1)return f(),this._onInvalidFile(),void(c&&c.apply(this,["file-invalid"]));if(g.size&&this._options.maxFileSize&&K(g.size)>this._options.maxFileSize)return f(),this._onOverWeightFile(),void(c&&c.apply(this,["file-too-big"]));this._imageEditor&&this._imageEditor.dirty(),this._data.input.name=T(g),this._data.input.type=U(g),this._data.input.size=g.size,this._data.input.file=g,aa(g,this._options.internalCanvasSize,function(a,b){var e=function(){d._imageHopper&&(d._imageHopper.enabled=!0),d._removeState("loading"),d._removeState("busy"),d._addState("empty"),d._stopProgressLoop(),d._resetData()};if(!a)return e(),void(c&&c.apply(d,["file-not-found"]));if(!pa(a,d._options.minSize))return e(),d._onImageTooSmall(),void(c&&c.apply(d,["image-too-small"]));var f=d._options.didLoad.apply(d,[g,a,b]);if(f!==!0)return e(),f!==!1&&d._throwError(f),void(c&&c.apply(d,[f]));d._removeState("loading");var i=function(b){var c=d._getIntro(),e={fromScale:[1.25,1.25],scale:[1,1],fromOpacity:0,opacity:1,complete:function(){J(c),c.style.opacity=1,b()}};d.isDetached()?e.duration=1:(e.easing="spring",e.springConstant=.3,e.springDeceleration=.7),d._canInstantEdit()&&(e.delay=500,e.duration=1,d._doEdit()),h(c,e)};d._loadCanvas(a,function(a){d._addState("preview"),i(function(){d._canInstantEdit()||a||d._showButtons(),a||(d._stopProgressLoop(),d._removeState("busy")),c&&c.apply(d,[null,d.data])})},function(){d._canInstantEdit()||d._showButtons(),d._removeState("busy")})})}}},{key:"_loadCanvas",value:function(b,c,d){var e=this;if(!this._isBeingDestroyed){this._data.input.image=b,this._data.input.width=b.width,this._data.input.height=b.height,this._initialRotation&&(this._data.actions.rotation=this._initialRotation,this._initialRotation=null);var f=this._data.actions.rotation%180!==0;this._isFixedRatio()||(this._initialCrop?this._ratio=this._initialCrop.height/this._initialCrop.width:this._ratio=f?b.width/b.height:b.height/b.width,this._scaleDropArea(this._ratio)),this._initialCrop?(this._data.actions.crop=ta(this._initialCrop),this._data.actions.crop.type=Na.INITIAL,this._initialCrop=null):(this._data.actions.crop=ba(f?b.height:b.width,f?b.width:b.height,this._ratio),this._data.actions.crop.type=Na.AUTO),this._options.size&&(this._data.actions.size={width:this._options.size.width,height:this._options.size.height}),this._applyTransforms(b,function(a){var b=e._getIntro(),f=b.offsetWidth/a.width,g=!1;e._options.service&&e._options.push&&(e._hasInitialImage||e._canInstantEdit()||(g=!0,e._stopProgressLoop(function(){e._startProgress(function(){e._updateProgress(.1)})}))),e._canInstantEdit()||e._save(function(){e._isBeingDestroyed||g&&(e._stopProgress(),d())},g),b.src="",b.src=ka(a,f).toDataURL(),b.onload=function(){b.onload=null,e._isBeingDestroyed||c&&c(g)}})}}},{key:"_applyTransforms",value:function(b,c){var d=this,e=ta(this._data.actions);e.filters={sharpen:this._options.filterSharpen/100},ca(b,e,function(a){var b=a;if(d._options.forceSize||d._options.size&&1==ia(d._options.size,a)){b=x("canvas"),b.width=d._options.size.width,b.height=d._options.size.height;var e=b.getContext("2d");e.drawImage(a,0,0,d._options.size.width,d._options.size.height)}d._data.output.width=b.width,d._data.output.height=b.height,d._data.output.image=b,d._onTransformCanvas(function(a){d._data=a,d._options.didTransform.apply(d,[d.data]),c(d._data.output.image)})})}},{key:"_onTransformCanvas",value:function(b){this._options.willTransform.apply(this,[this.data,b])}},{key:"_appendEditor",value:function(){var b=this;this._imageEditor||(this._imageEditor=new Ia(x("div"),{minSize:this._options.minSize,buttonConfirmClassName:this._options.buttonConfirmClassName,buttonCancelClassName:this._options.buttonCancelClassName,buttonRotateClassName:this._options.buttonRotateClassName,buttonConfirmLabel:this._options.buttonConfirmLabel,buttonCancelLabel:this._options.buttonCancelLabel,buttonRotateLabel:this._options.buttonRotateLabel,buttonConfirmTitle:this._options.buttonConfirmTitle,buttonCancelTitle:this._options.buttonCancelTitle,buttonRotateTitle:this._options.buttonRotateTitle}),Qa.forEach(function(a){b._imageEditor.element.addEventListener(a,b)}))}},{key:"_scaleDropArea",value:function(b){var c=this._getRatioSpacerElement();c&&this._element&&(c.style.marginBottom=100*b+"%",this._element.setAttribute("data-ratio","1:"+b))}},{key:"_onCancel",value:function(b){this._removeState("editor"),this._showButtons(),this._hideEditor(),this._options.instantEdit&&!this._hasInitialImage&&this._isAutoCrop()&&this._doRemove()}},{key:"_onConfirm",value:function(b){var c=this,d=this._options.service&&this._options.push;d?this._startProgress(function(){c._updateProgress(.1)}):this._startProgressLoop(),this._removeState("editor"),this._addState("busy"),this._output.value="",this._data.actions.rotation=b.detail.rotation,this._data.actions.crop=b.detail.crop,this._data.actions.crop.type=Na.MANUAL,this._applyTransforms(this._data.input.image,function(a){var b=c._getInOut(),e="out"===b[0].className?b[0]:b[1],f=e===b[0]?b[1]:b[0];e.className="in",e.style.opacity="0",e.style.zIndex="2",f.className="out",f.style.zIndex="1",e.src="",e.src=ka(a,e.offsetWidth/a.width).toDataURL(),e.onload=function(){e.onload=null,"free"===c._options.ratio&&(c._ratio=e.naturalHeight/e.naturalWidth,c._scaleDropArea(c._ratio)),c._hideEditor();var a=setTimeout(function(){c._showPreview(e,function(){c._save(function(a,b,e){c._toggleButton("upload",!0),d?c._stopProgress():c._stopProgressLoop(),c._removeState("busy"),c._showButtons()},d)})},250);c._timers.push(a)}})}},{key:"_cropAuto",value:function(){var c=arguments.length>0&&arguments[0]!==b?arguments[0]:function(a){},d=this._data.actions.rotation%180!==0,e=ba(d?this._data.input.image.width:this._data.input.image.height,d?this._data.input.image.height:this._data.input.image.width,this._ratio);this._crop(e.x,e.y,e.width,e.height,c,Na.AUTO)}},{key:"_crop",value:function(c,d,e,f){var g=arguments.length>4&&arguments[4]!==b?arguments[4]:function(a){},h=arguments.length>5&&arguments[5]!==b?arguments[5]:Na.MANUAL;this._output.value="",this._data.actions.crop={x:c,y:d,width:e,height:f},this._data.actions.crop.type=h,this._manualTransform(g)}},{key:"_manualTransform",value:function(b){var c=this;this._startProgressLoop(),this._addState("busy"),this._applyTransforms(this._data.input.image,function(a){var d=c._getInOut(),e="out"===d[0].className?d[0]:d[1],f=e===d[0]?d[1]:d[0];e.className="in",e.style.opacity="1",e.style.zIndex="2",f.className="out",f.style.zIndex="0",e.src="",e.src=ka(a,e.offsetWidth/a.width).toDataURL(),e.onload=function(){e.onload=null,"free"===c._options.ratio&&(c._ratio=e.naturalHeight/e.naturalWidth,c._scaleDropArea(c._ratio));var a=c._options.service&&c._options.push,d=function(){c._save(function(d,e,f){a||c._stopProgressLoop(),c._removeState("busy"),b.apply(c,[c.data])},a)};a?c._startProgress(d):d()}})}},{key:"_save",value:function(){var c=this,d=arguments.length>0&&arguments[0]!==b?arguments[0]:function(){},e=!(arguments.length>1&&arguments[1]!==b)||arguments[1];if(!this._isBeingDestroyed){var f=this.dataBase64;this._options.service||this._isInitialising&&!this._isImageOnly()||this._options.willSave.apply(this,[f,function(a){c._store(a),c._options.didSave.apply(c,[a])}]),this._isBeingDestroyed||(this._options.service&&e&&this._options.willSave.apply(this,[f,function(a){c._addState("upload"),c._upload(a,function(b,e){b||c._storeServerResponse(e),c._options.didUpload.apply(c,[b,a,e]),c._removeState("upload"),d(b,a,e)})}]),this._options.service&&e||d())}}},{key:"_storeServerResponse",value:function(b){this._isRequired&&(this._input.required=!1),this._data.server=b,this._output.value="object"===("undefined"==typeof b?"undefined":k(b))?JSON.stringify(this._data.server):b}},{key:"_store",value:function(b){this._isRequired&&(this._input.required=!1),this._output.value=JSON.stringify(b)}},{key:"_upload",value:function(b,c){var d=this,e=new FormData;if(null!==this._data.output.image&&this._options.uploadBase64===!1){var f=$(b.output.image,b.output.name),g="slim_output_"+this._uid;b.output.image=null,b.output.field=g,e.append(g,f,b.output.name)}e.append(this._output.name,JSON.stringify(b)),H("input",this._options.post)&&e.append(this._inputReference,this._data.input.file,this._data.input.file.name);var h=this._element.querySelector(".slim-upload-status"),i=this._options.willRequest;I(this._options.service,e,i,function(a,b){d._updateProgress(Math.max(.1,a/b))},function(a){var b=setTimeout(function(){if(!d._isBeingDestroyed){h.innerHTML=d._options.statusUploadSuccess,h.setAttribute("data-state","success"),h.style.opacity=1;var a=setTimeout(function(){h.style.opacity=0},2e3);d._timers.push(a)}},250);d._timers.push(b),c(null,a)},function(a){var b="";b="file-too-big"===a?d._options.statusContentLength:d._options.didReceiveServerError.apply(d,[a,d._options.statusUnknownResponse]);var e=setTimeout(function(){h.innerHTML=b,h.setAttribute("data-state","error"),h.style.opacity=1},250);d._timers.push(e),c(a)})}},{key:"_showEditor",value:function(){Sa.show(),this._imageEditor.show()}},{key:"_hideEditor",value:function(){this._imageEditor.hide();var b=setTimeout(function(){Sa.hide()},250);this._timers.push(b)}},{key:"_showPreview",value:function(b,c){h(b,{fromPosition:[0,50,0],position:[0,0,0],fromScale:[1.5,1.5],scale:[1,1],fromOpacity:0,opacity:1,easing:"spring",springConstant:.3,springDeceleration:.7,complete:function(){J(b),c&&c()}})}},{key:"_hideResult",value:function(b){var c=this._getIntro();c&&h(c,{fromScale:[1,1],scale:[.5,.5],fromOpacity:1,opacity:0,easing:"spring",springConstant:.3,springDeceleration:.75,complete:function(){J(c),b&&b()}})}},{key:"_showButtons",value:function(b){if(this._btnGroup){this._btnGroup.style.display="";var c={fromScale:[.5,.5],scale:[1,1],fromPosition:[0,10,0],position:[0,0,0],fromOpacity:0,opacity:1,complete:function(){J(this)},allDone:function(){b&&b()}};this.isDetached()?c.duration=1:(c.delay=function(a){return 250+50*a},c.easing="spring",c.springConstant=.3,c.springDeceleration=.85),h(this._btnGroup.childNodes,c)}}},{key:"_hideButtons",value:function(b){var c=this;if(this._btnGroup){var d={fromScale:[1,1],scale:[.85,.85],fromOpacity:1,opacity:0,allDone:function(){c._btnGroup.style.display="none",b&&b()}};this.isDetached()?d.duration=1:(d.easing="spring",d.springConstant=.3,d.springDeceleration=.75),h(this._btnGroup.childNodes,d)}}},{key:"_hideStatus",value:function(){var b=this._element.querySelector(".slim-upload-status");b.style.opacity=0}},{key:"_doEdit",value:function(){var b=this;this._data.input.image&&(this._addState("editor"),this._imageEditor||this._appendEditor(),this._imageEditor.showRotateButton=this._options.rotateButton,Sa.inner=this._imageEditor.element,this._imageEditor.open(ja(this._data.input.image),"free"===this._options.ratio?null:this._ratio,this._data.actions.crop,this._data.actions.rotation,function(){b._showEditor(),b._hideButtons(),b._hideStatus()}))}},{key:"_doRemove",value:function(){var b=this;if(!this._isImageOnly()){this._clearState(),this._addState("empty"),this._hasInitialImage=!1,this._imageHopper.enabled=!0,this._isRequired&&(this._input.required=!0);var c=this._getOutro();c&&(c.style.opacity="0");var d=this.data;this._resetData();var e=setTimeout(function(){b._isBeingDestroyed||(b._hideButtons(function(){b._toggleButton("upload",!0)}),b._hideStatus(),b._hideResult(),b._options.didRemove.apply(b,[d]))},this.isDetached()?0:250);return this._timers.push(e),d}}},{key:"_doUpload",value:function(b){var c=this;this._data.input.image&&(this._addState("upload"),this._startProgress(),this._hideButtons(function(){c._toggleButton("upload",!1),c._save(function(a,d,e){c._removeState("upload"),c._stopProgress(),b&&b.apply(c,[a,d,e]),a&&c._toggleButton("upload",!0),c._showButtons()})}))}},{key:"_doDownload",value:function(){var b=this._data.output.image;b&&za(this._data,this._options.jpegCompression,this._options.forceType)}},{key:"_doDestroy",value:function(){function c(a,b){return 0!==b.filter(function(b){return a.name===b.name&&a.value===b.value}).length}var b=this;this._isBeingDestroyed=!0,this._timers.forEach(function(a){clearTimeout(a)}),this._timers=[],h(this._element,"detach"),this._imageHopper&&(Pa.forEach(function(a){b._imageHopper.element.removeEventListener(a,b)}),this._imageHopper.destroy(),this._imageHopper=null),this._imageEditor&&(Qa.forEach(function(a){b._imageEditor.element.removeEventListener(a,b)}),this._imageEditor.destroy(),this._imageEditor=null),Ba(this._btnGroup.children).forEach(function(a){a.removeEventListener("click",b)}),this._input.removeEventListener("change",this),this._element!==this._originalElement&&this._element.parentNode&&this._element.parentNode.replaceChild(this._originalElement,this._element),this._originalElement.innerHTML=this._originalElementInner;var d=p(this._originalElement);d.forEach(function(a){c(a,b._originalElementAttributes)||b._originalElement.removeAttribute(a.name)}),this._originalElementAttributes.forEach(function(a){c(a,d)||b._originalElement.setAttribute(a.name,a.value)}),Ta=Math.max(0,Ta-1),Sa&&0===Ta&&(Sa.destroy(),Sa=null),this._originalElement=null,this._element=null,this._input=null,this._output=null,this._btnGroup=null,this._options=null}},{key:"dataBase64",get:function(){return ya(this._data,this._options.post,this._options.jpegCompression,this._options.forceType,null!==this._options.service)}},{key:"data",get:function(){return va(this._data)}},{key:"element",get:function(){return this._element}},{key:"service",set:function(b){this._options.service=b}},{key:"size",set:function(b){this.setSize(b,null)}},{key:"rotation",set:function(b){this.setRotation(b,null)}},{key:"ratio",set:function(b){this.setRatio(b,null)}}],[{key:"options",value:function(){var b={edit:!0,instantEdit:!1,uploadBase64:!1,meta:{},ratio:"free",size:null,rotation:null,crop:null,post:["output","actions"],service:null,filterSharpen:0,push:!1,defaultInputName:"slim[]",minSize:{width:100,height:100},maxFileSize:null,jpegCompression:null,download:!1,saveInitialImage:!1,forceType:!1,forceSize:null,internalCanvasSize:{width:4096,height:4096},rotateButton:!0,label:"<p>Drop your image here</p>",labelLoading:"<p>Loading image...</p>",statusFileType:"<p>Invalid file type, expects: $0.</p>",statusFileSize:"<p>File is too big, maximum file size: $0 MB.</p>",statusNoSupport:"<p>Your browser does not support image cropping.</p>",statusImageTooSmall:"<p>Image is too small, minimum size is: $0 pixels.</p>",statusContentLength:'<span class="slim-upload-status-icon"></span> The file is probably too big',statusUnknownResponse:'<span class="slim-upload-status-icon"></span> An unknown error occurred',statusUploadSuccess:'<span class="slim-upload-status-icon"></span> Saved',didInit:function(b){},didLoad:function(b,c,d){return!0},didSave:function(b){},didUpload:function(b,c,d){},didReceiveServerError:function(b,c){return c},didRemove:function(b){},didTransform:function(b){},willTransform:function(b,c){c(b)},willSave:function(b,c){c(b)},willRemove:function(b,c){c()},willRequest:function(b){}};return Ra.concat(Ia.Buttons).concat("rotate").forEach(function(a){var c=E(a);b["button"+c+"ClassName"]=null,b["button"+c+"Label"]=c,b["button"+c+"Title"]=c}),b}}]),a}();return function(){function c(a){return a?"<p>"+a+"</p>":null}function d(a){var b=window,c=a.split(".");return c.forEach(function(a,d){b[c[d]]&&(b=b[c[d]])}),b!==window?b:null}var a=[],b=function(c){for(var d=0,e=a.length;d<e;d++)if(a[d].isAttachedTo(c))return d;return-1},e=function(b){return b},f=function(b){return"true"===b},g=function(b){return!b||"true"===b},h=function(b){return c(b)},i=function(b){return b?d(b):null},j=function(b){if(!b)return null;var c=La(b,",");return{width:c[0],height:c[1]}},k=function(b){return b?parseFloat(b):null},l=function(b){return b?parseInt(b,10):null},m=function(b){if(!b)return null;var c={};return b.split(",").map(function(a){return parseInt(a,10)}).forEach(function(a,b){c[Oa[b]]=a}),c},o={download:f,edit:g,instantEdit:f,minSize:j,size:j,forceSize:j,internalCanvasSize:j,service:function(b){return"undefined"==typeof b?null:b},push:f,rotation:function(b){return"undefined"==typeof b?null:parseInt(b,10)},crop:m,post:function(b){return b?b.split(",").map(function(a){return a.trim()}):null},defaultInputName:e,ratio:function(b){return b?b:null},maxFileSize:k,filterSharpen:l,jpegCompression:l,uploadBase64:f,forceType:e,saveInitialImage:f,rotateButton:g,label:h,labelLoading:h};["FileSize","FileType","NoSupport","ImageTooSmall"].forEach(function(a){o["status"+a]=h}),["ContentLength","UnknownResponse","UploadSuccess"].forEach(function(a){o["status"+a]=e}),["Init","Load","Save","Upload","Remove","Transform","ReceiveServerError"].forEach(function(a){o["did"+a]=i}),["Transform","Save","Remove","Request"].forEach(function(a){o["will"+a]=i});var p=["ClassName","Label","Title"];Ra.concat(Ia.Buttons).concat("rotate").forEach(function(a){var b=E(a);p.forEach(function(a){o["button"+b+a]=e})}),Xa.supported=function(){return!("[object OperaMini]"===Object.prototype.toString.call(window.operamini)||"undefined"==typeof window.addEventListener||"undefined"==typeof window.FileReader||"undefined"==typeof window.URL||"undefined"==typeof window.URL.createObjectURL)}(),Xa.parse=function(a){var b,c,d,e=[];for(b=a.querySelectorAll(".slim:not([data-state])"),d=b.length;d--;)c=b[d],e.push(Xa.create(c,Xa.getOptionsFromAttributes(c)));return e},Xa.getOptionsFromAttributes=function(a){var b=n(a),c={meta:{}};for(var d in b){var e=o[d],f=b[d];e?(f=e(f),f=null===f?ta(Xa.options()[d]):f,c[d]=f):0===d.indexOf("meta")&&(c.meta[D(d.substr(4))]=f)}return c},Xa.find=function(b){var c=a.filter(function(a){return a.isAttachedTo(b)});return c?c[0]:null},Xa.create=function(b,c){if(!Xa.find(b)){c||(c=Xa.getOptionsFromAttributes(b));var d=new Xa(b,c);return a.push(d),d}},Xa.destroy=function(c){var d=b(c);return!(d<0)&&(a[d].destroy(),a.splice(d,1),!0)}}(),Xa}();a.fn.slim=function(){var a=d(arguments);if(e(a))return this.each(function(){c.create(this,a[0])});var b=a.shift();switch(b){case"supported":return c.supported;case"destroy":return this.each(function(){c.destroy(this)});case"parse":return this.each(function(){c.parse(this)});default:var i=[];return this.each(function(){var d=c.find(this);d&&(h(d,b)?i.push(d[b].apply(d,a)):f(d,b)?i.push(d[b]):g(d,b)&&i.push(d[b]=a[0]))}),i}}}}(window.jQuery);